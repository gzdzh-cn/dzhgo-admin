import{q as e,w as s,v as t}from"./@vue.runtime-dom-0c977c95.js";import{d as a}from"./dayjs-89173748.js";import{D as o}from"./vuedraggable-16c38432.js";import{J as r,u as i,P as l}from"./@element-plus.icons-vue-15072d5d.js";import{u as p,b as u,m as d}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{a as m}from"./element-plus-961823fe.js";import{h as n,u as c,e as f}from"./index-4d43d044.js";import{_ as j,g,f as v,b as h,c as b}from"./viewer.vue_vue_type_script_setup_true_name_item-viewer_lang-7e2cce89.js";import{x as y,B as _}from"./lodash-es-8394daf0.js";import{f as k,C as w,A as x,a5 as z,o as S,c as U,a as B,g as C,W as D,Q as V,Z as q,V as $,R as A,F,_ as P,X as L}from"./@vue.runtime-core-dd57a9c9.js";import{r as M,h as I,M as O}from"./@vue.reactivity-9aee8bf6.js";import{D as Y,ak as N}from"./@vue.shared-dddd31b8.js";import{_ as R}from"./vue-qr-c4264fa6.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./sortablejs-626322a9.js";import"./vue-6d1d317a.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./store-52839c99.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./js-binary-schema-parser-814ef804.js";const E={key:0,class:"cl-upload__file-btn"},K={key:0,class:"cl-upload__footer"},G={class:"cl-upload__item"},J={class:"cl-upload__text"},Q={class:"cl-upload__name"},T={class:"cl-upload__size"},W={class:"cl-upload__actions"},X=["onClick"],Z=["onClick"],H={key:2,class:"cl-upload__progress"},ee={key:3,class:"cl-upload__error"},se=k({name:"cl-upload"}),te=R(k({...se,props:{modelValue:{type:[String,Array],default:()=>[]},type:{type:String,default:"image"},accept:String,multiple:Boolean,limit:Number,limitSize:Number,limitUpload:{type:Boolean,default:!0},size:[String,Number,Array],text:String,prefixPath:{type:String,default:"app"},showFileList:{type:Boolean,default:!0},draggable:Boolean,disabled:Boolean,customClass:String,beforeUpload:Function,isEdit:null,scope:null,isDisabled:Boolean},emits:["update:modelValue","upload","success","error","progress"],setup(k,{expose:R,emit:se}){const te=k;e((e=>({"033290e3":O(pe)[0],"03329102":O(pe)[1]})));const{service:ae}=p(),{user:oe}=u(),{options:re}=d.get("upload"),ie=M(),le=M(),pe=w((()=>{const e=te.size||re.size;return(y(e)?e:[e,e]).map((e=>_(e)?e+"px":e))})),ue=w((()=>te.isDisabled||te.disabled)),de=te.limit||re.limit.upload,me=te.limitSize||re.limit.size,ne=te.text||re.text,ce=w((()=>({Authorization:oe.token}))),fe=M([]),je=I({options:{group:"Upload",animation:300,ghostClass:"Ghost",dragClass:"Drag",draggable:".is-drag",disabled:!te.draggable}}),ge=w((()=>te.accept||("file"==te.type?"*":"image/*"))),ve=w((()=>te.multiple?de-fe.value.length>0:0==fe.value.length));function he(e){var s;return"image"==te.type?"image":null==(s=b(e))?void 0:s.value}async function be(e,s){function t(){const t={type:he(e.name),preload:"",progress:0,url:"",uid:e.uid,size:e.size};return t.preload="image"==t.type?window.webkitURL.createObjectURL(e):e.name,s?Object.assign(s,t):te.multiple?!ve.value&&te.limitUpload||fe.value.push(t):fe.value=[t],se("upload",t),!0}if(te.beforeUpload){const a=te.beforeUpload(e,s);return n(a)?a.then(t).catch((()=>null)):a&&t(),a}return e.size/1024/1024>=me?(m.error(`上传文件大小不能超过 ${me}MB!`),!1):t()}function ye(e){fe.value.splice(e,1),we()}function _e(){fe.value=[]}async function ke(e,s){if(s||(s=fe.value.find((s=>s.uid==e.file.uid))),!s)return!1;try{let t=c()+"_"+e.file.name;const{mode:o,type:r}=await ae.base.comm.uploadMode();return new Promise(((i,l)=>{async function p({host:r,preview:p,data:u}){const d=new FormData;for(const e in u)d.append(e,u[e]);"cloud"==o&&(t=[te.prefixPath,a().format("YYYY-MM-DD"),t].filter(Boolean).join("/")),d.append("key",t),d.append("file",e.file),await ae.request({url:r,method:"POST",headers:{"Content-Type":"multipart/form-data"},timeout:6e5,data:d,onUploadProgress(e){s.progress=parseInt(String(e.loaded/e.total*100)),se("progress",s)},proxy:"local"==o}).then((e=>{s.url="local"===o?e:`${p||r}/${t}`,se("success",s),i(s.url),we()})).catch((e=>{m.error(e.message),s.error=e.message,se("error",s),l(e)}))}"local"==o?p({host:"/admin/base/comm/upload"}):ae.base.comm.upload().then((e=>{switch(r){case"cos":p({host:e.url,data:e.credentials});break;case"oss":p({host:e.host,data:{OSSAccessKeyId:e.OSSAccessKeyId,policy:e.policy,signature:e.signature}});break;case"qiniu":p({host:e.uploadUrl,preview:e.publicDomain,data:{token:e.token}})}})).catch(l)}))}catch(t){m.error("上传配置错误")}}function we(){fe.value.find((e=>!e.url))||se("update:modelValue",g(fe.value))}return x((()=>te.modelValue),(e=>{const s=(y(e)?e:(e||"").split(",")).filter(Boolean);fe.value=s.map((e=>{const s=fe.value.find((s=>e==s.url));return s||{type:he(e),progress:0,uid:c(),url:e,preload:e}})).filter(((e,s)=>!!te.multiple||0==s))}),{immediate:!0}),R({isAdd:ve,list:fe,check:function(){return fe.value.find((e=>100!=e.progress))},clear:_e,remove:ye,upload(e){_e(),ie.value.clearFiles(),ie.value.handleStart(e),ie.value.submit()}}),(e,a)=>{const p=z("el-button"),u=z("el-upload"),d=z("el-icon"),m=z("el-image"),n=z("el-progress");return S(),U(F,null,[B("div",{class:Y(["cl-upload__wrap",[k.customClass]])},[B("div",{class:Y(["cl-upload",[`cl-upload--${k.type}`,{"is-disabled":O(ue)}]])},["file"==k.type?(S(),U("div",E,[C(u,{ref_key:"Upload",ref:ie,action:"",accept:O(ge),"show-file-list":!1,"before-upload":be,"http-request":ke,headers:O(ce),multiple:k.multiple,disabled:O(ue)},{default:D((()=>[V(e.$slots,"default",{},(()=>[C(p,{type:"success"},{default:D((()=>[P(N(O(ne)),1)])),_:1})]),!0)])),_:3},8,["accept","headers","multiple","disabled"])])):q("",!0),k.showFileList?(S(),$(O(o),A({key:1,class:"cl-upload__list",tag:"div",modelValue:fe.value,"onUpdate:modelValue":a[0]||(a[0]=e=>fe.value=e)},je.options,{"item-key":"uid",onEnd:we}),{footer:D((()=>["image"==k.type&&O(ve)?(S(),U("div",K,[C(u,{ref_key:"Upload",ref:ie,action:"",accept:O(ge),"show-file-list":!1,"before-upload":be,"http-request":ke,headers:O(ce),multiple:k.multiple,disabled:O(ue)},{default:D((()=>[V(e.$slots,"default",{},(()=>[B("div",G,[C(d,{size:24},{default:D((()=>[C(O(r))])),_:1}),B("span",J,N(O(ne)),1)])]),!0)])),_:3},8,["accept","headers","multiple","disabled"])])):q("",!0)])),item:D((({element:a,index:o})=>[k.showFileList?(S(),$(u,{key:0,action:"",class:"is-drag",accept:O(ge),"show-file-list":!1,"http-request":e=>ke(e,a),"before-upload":e=>{be(e,a)},headers:O(ce),disabled:O(ue)},{default:D((()=>[V(e.$slots,"item",{item:a,index:o},(()=>[B("div",{class:Y(["cl-upload__item",[`is-${a.type}`]])},["image"==a.type?(S(),$(m,{key:0,src:a.preload,fit:"cover"},null,8,["src"])):(S(),U(F,{key:1},[B("span",Q,N(O(v)(a.preload))+"."+N(O(f)(a.preload)),1),B("span",T,N(O(h)(a.size)),1)],64)),B("div",W,[L(B("span",{class:"icon-preview",onClick:s((e=>function(e){var s;"image"==e.type?null==(s=le.value)||s.open(e.preload,fe.value.map((e=>e.preload))):window.open(e.url)}(a)),["stop"])},[C(d,null,{default:D((()=>[C(O(i))])),_:1})],8,X),[[t,a.url]]),O(ue)?q("",!0):(S(),U("span",{key:0,class:"icon-delete",onClick:s((e=>ye(o)),["stop"])},[C(d,null,{default:D((()=>[C(O(l))])),_:1})],8,Z))]),a.progress>0&&a.progress<100?(S(),U("div",H,[C(n,{percentage:a.progress,"show-text":!1},null,8,["percentage"])])):q("",!0),a.error?(S(),U("div",ee,N(a.error),1)):q("",!0)],2)]),!0)])),_:2},1032,["accept","http-request","before-upload","headers","disabled"])):q("",!0)])),_:3},16,["modelValue"])):q("",!0)],2)],2),C(j,{ref_key:"Viewer",ref:le},null,512)],64)}}}),[["__scopeId","data-v-5bc496c6"]]);export{te as default};
