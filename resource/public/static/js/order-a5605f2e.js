import{i as e}from"./index.umd.min-b68308bb.js";import{u as l,d as o,b as a,f as r}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{e as n,a as t,g as p,d as u}from"./element-plus-961823fe.js";import"./store-52839c99.js";import"./index-4d43d044.js";import{v as d,w as i}from"./@vue.runtime-dom-0c977c95.js";import{a6 as s,a7 as m,E as c,a8 as v}from"./@element-plus.icons-vue-15072d5d.js";import{u as b}from"./component-942ac5f4.js";import{l as f}from"./lodash-c1867463.js";import{x as y}from"./lodash-es-8394daf0.js";import{f as h,h as g,a5 as w,a9 as I,o as j,c as k,a as _,g as Y,W as D,Z as x,X as T,_ as C,V as M,aT as N,aS as V,A as F,a3 as O,F as q}from"./@vue.runtime-core-dd57a9c9.js";import{r as U,M as $,h as z}from"./@vue.reactivity-9aee8bf6.js";import{D as E,ak as S}from"./@vue.shared-dddd31b8.js";import{_ as R}from"./vue-qr-c4264fa6.js";import{d as W}from"./dayjs-89173748.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./js-binary-schema-parser-814ef804.js";const L={class:"dept-tree"},A={class:"dept-tree__header"},B=(e=>(N("data-v-22d67235"),e=e(),V(),e))((()=>_("div",null,"订单类型",-1))),P={class:"dept-tree__op"},G={class:"no"},Q=["onContextmenu"],H={class:"dept-tree__node"},X=["onClick"],Z=["onClick"],J=h({name:"dept-tree"}),K=R(h({...J,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99},orderInfo:Object},emits:["refresh"],setup(a,{emit:r}){const p=a,{service:u,browser:v}=l(),{ViewGroup:h}=b(),N=e.useForm(),V=U([{name:"全部",value:"all"}]),F=U(!1),O=U(!1);function q({data:e}){return e.parentId}function z(e,l){return l.data.parentId}const R=async()=>{F.value=!0,O.value=!1,await u.dict.info.data({types:["subOrderType"]}).then((e=>{var l;V.value.push(...e.subOrderType),(null==(l=h.value)?void 0:l.selected)||W()})),F.value=!1};function W(e){var l,o,a,n,t,u;if(e){if(e){r("refresh",{page:1,orderType:e.value}),null==(n=h.value)||n.select(e);let l=f.isEmpty(p.orderInfo)?e.name:`${null==(t=p.orderInfo)?void 0:t.projectNum} -  ${e.name}`;null==(u=h.value)||u.setTitle(`子订单列表（${l})`)}}else{r("refresh",{page:1}),null==(l=h.value)||l.select(e);var d=f.isEmpty(p.orderInfo)?"全部":`${null==(o=p.orderInfo)?void 0:o.projectNum} - 全部`;null==(a=h.value)||a.setTitle(`子订单列表 (${d})`)}}function J(e){var l;const o=e.id?"update":"add";null==(l=N.value)||l.open({title:"编辑部门",width:"550px",props:{labelWidth:"100px"},items:[{label:"部门名称",prop:"name",component:{name:"el-input"},required:!0},{label:"上级部门",prop:"parentName",component:{name:"el-input",props:{disabled:!0}}},{label:"排序",prop:"orderNum",component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{submit(l,{done:a,close:r}){u.base.sys.department[o]({id:e.id,parentId:e.parentId,name:l.name,orderNum:l.orderNum}).then((()=>{t.success(`新增部门 “${l.name}” 成功`),r(),R()})).catch((e=>{t.error(e.message),a()}))}}})}function K(e){e?n.confirm("部门架构已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function l(o,a){o.forEach((o=>{o.parentId=a,e.push(o),o.children&&y(o.children)&&l(o.children,o.id)}))}(V.value,null),await u.base.sys.department.order(e.map(((e,l)=>({id:e.id,parentId:e.parentId,orderNum:l})))).then((()=>{t.success("更新排序成功")})).catch((e=>{t.error(e.message)})),R(),O.value=!1})).catch((()=>null)):R()}function ee(l,a,r){a||(a=V.value[0]||{});const d=u.base.sys.department.permission;e.ContextMenu.open(l,{list:[{label:"新增",hidden:r&&r.level>=p.level||!o(d.add),callback(e){J({name:"",parentName:a.name,parentId:a.id}),e()}},{label:"编辑",hidden:!o(d.update),callback(e){J(a),e()}},{label:"删除",hidden:!a.parentId||!o(d.delete),callback(e){!function(e){async function l(l){await u.base.sys.department.delete({ids:[e.id],deleteUser:l}).then((()=>{var o,a;(null==(a=null==(o=h.value)?void 0:o.selected)?void 0:a.id)==e.id&&W(),l?t.success("删除成功"):n.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),R()}n.confirm(`该操作会删除 “${e.name}” 部门的所有用户，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"保留用户",distinguishCancelAndClose:!0}).then((()=>{l(!0)})).catch((e=>{"cancel"==e&&l(!1)}))}(a),e()}}]})}return g((function(){R()})),(e,l)=>{const o=w("el-icon"),r=w("el-tooltip"),n=w("el-button"),t=w("el-tree"),p=w("el-scrollbar"),u=w("cl-form"),b=I("loading");return j(),k("div",L,[_("div",A,[B,_("ul",P,[_("li",{onClick:l[0]||(l[0]=e=>R())},[Y(r,{content:"刷新"},{default:D((()=>[Y(o,null,{default:D((()=>[Y($(s))])),_:1})])),_:1})]),a.drag&&!$(v).isMini?(j(),k("li",{key:0,onClick:l[1]||(l[1]=e=>O.value=!0)},[Y(r,{content:"拖动排序"},{default:D((()=>[Y(o,null,{default:D((()=>[Y($(m))])),_:1})])),_:1})])):x("",!0),T(_("li",G,[Y(n,{onClick:l[2]||(l[2]=e=>K(!0)),size:"small"},{default:D((()=>[C("保存")])),_:1}),Y(n,{onClick:l[3]||(l[3]=e=>K(!1)),size:"small"},{default:D((()=>[C("取消")])),_:1})],512),[[d,O.value]])])]),_("div",{class:"dept-tree__container",onContextmenu:i(ee,["stop","prevent"])},[Y(p,null,{default:D((()=>[T((j(),M(t,{"node-key":"id","default-expand-all":"",data:V.value,props:{label:"name"},draggable:O.value,"allow-drag":q,"allow-drop":z,"expand-on-click-node":!1,onNodeContextmenu:ee},{default:D((({node:e,data:l})=>{var a,r;return[_("div",H,[_("span",{class:E(["dept-tree__node-label",{"is-active":l.id==(null==(r=null==(a=$(h))?void 0:a.selected)?void 0:r.id)}]),onClick:e=>W(l)},S(e.label),11,X),$(v).isMini?(j(),k("span",{key:0,class:"dept-tree__node-icon",onClick:o=>ee(o,l,e)},[Y(o,null,{default:D((()=>[Y($(c))])),_:1})],8,Z)):x("",!0)])]})),_:1},8,["data","draggable"])),[[b,F.value]])])),_:1})],40,Q),Y(u,{ref_key:"Form",ref:N},null,512)])}}}),[["__scopeId","data-v-22d67235"]]),ee={style:{padding:"20px 100px"}},le=_("h3",null,"订单明细：",-1),oe=_("br",null,null,-1),ae={key:0},re={style:{color:"crimson"}},ne=h({name:"sub-order"}),te=h({...ne,props:{orderInfo:Object},setup(o,{expose:n}){const t=o,{service:p}=l(),{user:u}=a(),{dict:d}=r(),i=U(1!=u.info.id),s=U(),m=U();F((()=>{var e;return null==(e=t.orderInfo)?void 0:e.id}),(async e=>{I({id:e})}),{deep:!0});const c=e.useUpsert({items:[{label:"会员",prop:"uid",span:12,required:!0,hidden:()=>1!=u.info.id,component:{name:"el-select",props:{}}},{label:"订单类型",prop:"orderType",required:!0,span:12,component:{name:"el-select",options:d.get("subOrderType"),props:{onChange:e=>{var l,o,a;h.value=e,"subRenewal"==e?null==(o=c.value)||o.setForm("endDate",W(null==(l=t.orderInfo)?void 0:l.endDate).add(1,"year").format("YYYY-MM-DD")):null==(a=c.value)||a.setForm("endDate",W().add(1,"year").format("YYYY-MM-DD"))}}}},{label:"域名",prop:"domain",hidden:({scope:e})=>"subDomain"!=e.orderType,component:{name:"el-input",disabled:()=>{var e;return"update"!==(null==(e=c.value)?void 0:e.mode)}}},{label:"域名归属我司",prop:"isSelf",span:12,hidden:({scope:e})=>"subDomain"!=e.orderType,value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}},group:"other"},{label:"是否备案",prop:"isIcp",span:12,hidden:({scope:e})=>"subDomain"!=e.orderType,value:0,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}},group:"other"},{label:"注册时间",prop:"startDate",span:12,hidden:({scope:e})=>"subDomain"!==e.orderType,value:W().format("YYYY-MM-DD"),component:{name:"el-date-picker",props:{type:"date",valueFormat:"YYYY-MM-DD"}},group:"base"},{label:"到期时间",prop:"endDate",required:!0,span:12,hidden:({scope:e})=>"subExtend"==e.orderType||"subRecord"==e.orderType,component:{name:"el-date-picker",props:{type:"date",valueFormat:"YYYY-MM-DD"}}},{label:"价格",prop:"price",required:!0,span:12,component:{name:"el-input",props:{suffixIcon:v}}},{label:"返佣",prop:"rebate",span:12,value:0,component:{name:"el-input",props:{suffixIcon:v}}},{label:"空间信息",prop:"vpsInfo",hidden:({scope:e})=>"subVps"!==e.orderType,component:{name:"el-input",props:{type:"textarea",rows:4}}},{label:"实名资料",prop:"realNameDataFiles",hidden:({scope:e})=>"subDomain"!==e.orderType,component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"其他资料",prop:"requirementFiles",hidden:({scope:e})=>"subRecord"!==e.orderType&&"subExtend"!==e.orderType,component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}},()=>({label:"项目进度",prop:"state",span:12,hidden:({scope:e})=>{var l;return"add"==(null==(l=c.value)?void 0:l.mode)||"subExtend"!==e.orderType},component:{name:"el-select",options:y}})],async onOpen(e){var l,o,a,r,n,d,i,s,m,v,b,f,y;if(1==u.info.id){const e=await p.base.sys.user.list();null==(l=c.value)||l.setOptions("uid",e.map((e=>({label:e.nickName||"",value:e.id||""})))),"add"==(null==(o=c.value)?void 0:o.mode)&&(null==(a=c.value)||a.setForm("uid",u.info.id))}"add"==(null==(r=c.value)?void 0:r.mode)&&(null==(d=c.value)||d.setTitle(`${null==(n=t.orderInfo)?void 0:n.projectNum}-新增子订单`),h.value&&(null==(i=c.value)||i.setForm("orderType",h.value))),"update"==(null==(s=c.value)?void 0:s.mode)&&(null==(v=c.value)||v.setTitle(`${null==(m=t.orderInfo)?void 0:m.projectNum}-编辑子订单`)),"subRenewal"==h.value&&(null==(f=c.value)||f.setForm("endDate",W(null==(b=t.orderInfo)?void 0:b.endDate).add(1,"year").format("YYYY-MM-DD"))),"subDomain"!=h.value&&"subVps"!=h.value||null==(y=c.value)||y.setForm("endDate",W().add(1,"year").format("YYYY-MM-DD"))},onSubmit(e,{next:l}){var o,a,r;let n={parentId:null==(o=t.orderInfo)?void 0:o.id,customerId:null==(a=t.orderInfo)?void 0:a.customerId,domain:V.value?V.value:e.domain};1!=(null==(r=u.info)?void 0:r.id)&&(n.uid=u.info.id),(null==e?void 0:e.domain)&&(e.domain=null==e?void 0:e.domain.trim()),l({...e,...n})}}),b=e.useTable({columns:[{type:"selection"},()=>({label:"#",type:"expand",prop:"detail"}),{label:"会员",prop:"userName",hidden:i},{label:"订单类型",prop:"orderType",dict:{text:!0,separator:"",options:d.get("subOrderType").value}},{label:"项目订单",prop:"orderCode",width:300},{label:"价格",prop:"price"},{label:"到期时间",prop:"createTime",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",buttons:["edit","delete"],width:160}]}),f=e.useCrud({service:p.crm.order,async onRefresh(e,{render:l}){const{list:o,pagination:a}=await p.crm.order.page(e);l(o,a)}}),y=z([{label:"待处理",type:"danger",value:0},{label:"处理中",type:"warning",value:1},{label:"已完成",type:"success",value:2}]),h=U(),I=async e=>{var l,o;e.id=null==(l=t.orderInfo)?void 0:l.id,h.value=e.orderType,e.sub=!0,null==(o=f.value)||o.refresh(e)},T=U(),N=U(),V=U(),O=e.useAdvSearch({items:[()=>({label:"下单者",prop:"uid",hidden:()=>{var e;return 1!=(null==(e=u.info)?void 0:e.id)},component:{name:"cl-select",props:{clearable:!0,options:[...s.value]}}}),()=>({label:"排序",prop:"orderBy",component:{name:"cl-select",props:{clearable:!0,options:[{label:"最近更新",value:"updateTimeDesc"}]}}}),{label:"项目进度",prop:"state",component:{name:"el-select",props:{clearable:!0},options:y}},{label:"到期区间",prop:"month",component:{name:"cl-select",props:{options:[{label:"当月",value:"0"},{label:"未来一个月",value:"1"},{label:"未来二个月",value:"2"},{label:"未来三个月",value:"3"},{label:"未来半年",value:"6"},{label:"未来一年",value:"12"}]}}},{label:"时间",prop:"dateTime",component:{name:"el-date-picker",props:{type:"daterange",startPlaceholder:"开始日期",endPlaceholder:"结束日期",value:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}}]});return g((async()=>{m.value=await p.base.sys.user.list(),s.value=m.value.map((e=>({label:e.nickName||"",value:e.id||""})))})),n({refresh:I}),(e,l)=>{const o=w("cl-refresh-btn"),a=w("cl-add-btn"),r=w("cl-multi-delete-btn"),n=w("cl-flex1"),t=w("cl-adv-btn"),p=w("cl-search-key"),u=w("cl-row"),d=w("cl-date-text"),i=w("cl-table"),s=w("cl-pagination"),m=w("el-input"),v=w("cl-col"),h=w("el-button"),g=w("cl-upsert"),I=w("cl-adv-search"),F=w("cl-crud");return j(),M(F,{ref_key:"Crud",ref:f},{default:D((()=>[Y(u,null,{default:D((()=>[Y(o),Y(a),Y(r),Y(n),Y(t),Y(p)])),_:1}),Y(u,null,{default:D((()=>[Y(i,{ref_key:"Table",ref:b,border:!1},{"column-detail":D((({scope:e})=>{var l,o;return[_("div",ee,[le,oe,"subRenewal"==(null==(l=e.row)?void 0:l.orderType)?(j(),k("p",ae,[C(" 到期时间： "),Y(d,{modelValue:e.row.endDate,"onUpdate:modelValue":l=>e.row.endDate=l,format:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])])):x("",!0),_("p",null,"备注: "+S(null==(o=e.row)?void 0:o.remark),1)])]})),"column-orderCode":D((({scope:e})=>{return[C(S(e.row.orderCode)+" ",1),_("span",re,S("subExtend"==e.row.orderType?":"+(l=e.row.state,null==(o=y.find((e=>e.value===l)))?void 0:o.label):""),1)];var l,o})),_:1},512)])),_:1}),Y(u,null,{default:D((()=>[Y(n),Y(s)])),_:1}),Y(g,{ref_key:"Upsert",ref:c},{"slot-newDomain":D((({scope:e})=>[Y(u,null,{default:D((()=>[Y(v,{span:18},{default:D((()=>[Y(m,{modelValue:N.value,"onUpdate:modelValue":l[0]||(l[0]=e=>N.value=e),placeholder:"不要添加http或https"},null,8,["modelValue"])])),_:1}),Y(v,null,{default:D((()=>[Y(h,{onClick:l=>(e=>{var l;let o="";o=N.value,""!=e&&(o=N.value+"\n"+e),V.value=o.trim().replace(/^https?:\/\//,"").replace(/\/$/,""),null==(l=c.value)||l.setForm("domain",V.value),N.value="",V.value=""})(e.domain)},{default:D((()=>[C("添加")])),_:2},1032,["onClick"])])),_:2},1024),Y(v,null,{default:D((()=>[Y(h,{onClick:l=>{return e.domain,null==(o=c.value)||o.setForm("domain",T.value),void(V.value=T.value);var o}},{default:D((()=>[C("重置")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:1},512),Y(I,{ref_key:"AdvSearch",ref:O},null,512)])),_:1},512)}}}),pe=h({name:"order-sub"}),ue=h({...pe,props:{orderInfo:Object},setup(e){const{ViewGroup:l}=b(),o=U(),a=e=>{var l;null==(l=o.value)||l.refresh(e)};return(r,n)=>{const t=w("cl-view-group");return j(),M(t,{ref_key:"ViewGroup",ref:l,leftWidth:"10%"},{left:D((()=>[Y(K,{onRefresh:a,orderInfo:e.orderInfo},null,8,["orderInfo"])])),right:D((()=>[Y(te,{ref_key:"subOrder",ref:o,orderInfo:e.orderInfo},null,8,["orderInfo"])])),_:1},512)}}}),de=e=>e&&e.replace(/<[^>]+>/gi,"").replace("\n\r",""),ie=(e,l)=>(l||(l=100),e?e.length<=l?e:e.slice(0,l)+"...":""),se=e=>new Date(e).getTime(),me=(e,l)=>se(e)>se(l),ce=h({name:"order-finance"}),ve=h({...ce,props:{orderInfo:Object},setup(o){var n;const t=o,{dict:p}=r(),{user:u}=a(),d=U(1!=(null==(n=u.info)?void 0:n.id)),i=U({});F((()=>t.orderInfo),(e=>{f({projectNum:e.projectNum})}),{deep:!0}),g((()=>{f()}));const{service:s}=l(),m=e.useUpsert({items:[{label:"会员",prop:"uid",span:12,required:!0,hidden:()=>1!=u.info.id,component:{name:"el-select",props:{}}},{label:"项目订单",prop:"orderCode",component:{name:"el-select",options:[]}},{label:"收款",prop:"receiveMoney",span:12,component:{name:"el-input",props:{suffixIcon:v}}},{label:"结算方式",prop:"paytype",span:12,component:{name:"el-select",options:p.get("paytype")}},{label:"结算日期",prop:"payDate",span:12,value:W().format("YYYY-MM-DD"),component:{name:"el-date-picker",props:{type:"date",valueFormat:"YYYY-MM-DD"}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}}],async onOpen(){var e,l,o,a,r,n,p,d,c,v,b;if(1==u.info.id){const a=await s.base.sys.user.list();null==(e=m.value)||e.setOptions("uid",a.map((e=>({label:e.nickName||"",value:e.id||""})))),"add"==(null==(l=m.value)?void 0:l.mode)&&(null==(o=m.value)||o.setForm("uid",u.info.id))}const f=await s.crm.order.list({projectNum:null==(a=t.orderInfo)?void 0:a.projectNum});null==(r=m.value)||r.setOptions("orderCode",f.map((e=>{i.value[e.orderCode]=e;const l=y(e.orderType);return{label:(null==l?void 0:l.label)+"-"+e.orderCode+"-"+ie(de(e.remark),10),value:e.orderCode}}))),"add"==(null==(n=m.value)?void 0:n.mode)&&(null==(d=m.value)||d.setTitle(`${null==(p=t.orderInfo)?void 0:p.projectNum}-新增订单`)),"update"==(null==(c=m.value)?void 0:c.mode)&&(null==(b=m.value)||b.setTitle(`${null==(v=t.orderInfo)?void 0:v.projectNum}-编辑订单`))},onSubmit(e,{next:l}){var o,a,r,n;let p={orderId:null==(o=i.value[e.orderCode])?void 0:o.id,orderType:null==(a=i.value[e.orderCode])?void 0:a.orderType,projectNum:null==(r=t.orderInfo)?void 0:r.projectNum,incomeAndOut:e.receiveMoney};1!=(null==(n=u.info)?void 0:n.id)&&(p.uid=u.info.id),l({...e,...p})}}),c=e.useTable({columns:[{type:"selection"},{label:"会员",prop:"userName",hidden:d},{label:"项目订单",prop:"orderCode"},{label:"收款",prop:"receiveMoney"},{label:"收款方式",prop:"paytype",dict:{text:!0,separator:"",options:p.get("paytype").value}},{label:"收款日期",prop:"payDate",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{label:"备注",prop:"remark",showOverflowTooltip:!0,minWidth:150},{type:"op",buttons:["edit","delete"]}]}),b=e.useCrud({service:s.crm.finance}),f=e=>{var l,o;const a={projectNum:(null==(l=t.orderInfo)?void 0:l.projectNum)|e};null==(o=b.value)||o.refresh(a)},y=e=>{const l=p.get("orderType").value.filter((l=>l.value==e));if(l.length>0)return l[0];const o=p.get("subOrderType").value.filter((l=>l.value==e));return o.length>0?o[0]:{}};return(e,l)=>{const o=w("cl-refresh-btn"),a=w("cl-add-btn"),r=w("cl-multi-delete-btn"),n=w("cl-flex1"),t=w("cl-search-key"),p=w("cl-row"),u=w("cl-table"),d=w("cl-pagination"),i=w("cl-upsert"),s=w("cl-crud");return j(),M(s,{ref_key:"Crud",ref:b},{default:D((()=>[Y(p,null,{default:D((()=>[Y(o),Y(a),Y(r),Y(n),Y(t)])),_:1}),Y(p,null,{default:D((()=>[Y(u,{ref_key:"Table",ref:c,border:!1},null,512)])),_:1}),Y(p,null,{default:D((()=>[Y(n),Y(d)])),_:1}),Y(i,{ref_key:"Upsert",ref:m},null,512)])),_:1},512)}}}),be={style:{width:"100%",height:"100%"}},fe=h({name:"history-reply"}),ye=h({...fe,props:{orderInfo:Object,historyInfo:Object},setup(o){var r;const n=o,{service:t}=l(),{user:p}=a(),u=U(1!=(null==(r=p.info)?void 0:r.id)),d=e.useUpsert({items:[{label:"会员",prop:"uid",required:!0,hidden:()=>1!=p.info.id,component:{name:"el-select",props:{}}},{label:"标题",prop:"title",required:!0,component:{name:"el-input"}},{label:"图片上传",prop:"imgs",component:{name:"cl-upload",props:{type:"image",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"文件上传",prop:"files",component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}}],async onOpen(){var e,l,o;if(1==p.info.id){const a=await t.base.sys.user.list();null==(e=d.value)||e.setOptions("uid",a.map((e=>({label:e.nickName||"",value:e.id||""})))),"add"==(null==(l=d.value)?void 0:l.mode)&&(null==(o=d.value)||o.setForm("uid",p.info.id))}},onSubmit(e,{next:l}){var o,a,r,t,u;let d={orderId:null==(o=n.orderInfo)?void 0:o.id,projectNum:null==(a=n.orderInfo)?void 0:a.projectNum,orderCode:null==(r=n.orderInfo)?void 0:r.orderCode,historyId:null==(t=n.historyInfo)?void 0:t.id};1!=(null==(u=p.info)?void 0:u.id)&&(d.uid=p.info.id),l({...e,...d})}}),i=e.useTable({columns:[{type:"selection"},{label:"会员",prop:"userName",hidden:u},{label:"标题",prop:"title"},{label:"备注",prop:"remark",showOverflowTooltip:!0,minWidth:150},{label:"创建时间",prop:"createTime",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",buttons:["edit","delete"]}]}),s=e.useCrud({service:t.crm.reply,async onRefresh(e,{render:l}){var o;e.historyId=null==(o=n.historyInfo)?void 0:o.id;const{list:a,pagination:r}=await t.crm.reply.page(e);l(a,r)}});return g((async()=>{var e;null==(e=s.value)||e.refresh()})),(e,l)=>{const o=w("cl-refresh-btn"),a=w("cl-add-btn"),r=w("cl-multi-delete-btn"),n=w("cl-flex1"),t=w("cl-search-key"),p=w("cl-row"),u=w("cl-table"),m=w("cl-pagination"),c=w("cl-upsert"),v=w("cl-crud");return j(),M(v,{ref_key:"Crud",ref:s},{default:D((()=>[Y(p,null,{default:D((()=>[Y(o),Y(a),Y(r),Y(n),Y(t)])),_:1}),Y(p,null,{default:D((()=>[_("div",be,[Y(u,{ref_key:"Table",ref:i},null,512)])])),_:1}),Y(p,null,{default:D((()=>[Y(n),Y(m)])),_:1}),Y(c,{ref_key:"Upsert",ref:d},null,512)])),_:1},512)}}}),he=h({name:"order-doHistory"}),ge=h({...he,props:{orderInfo:Object},setup(o){var n;const t=o;F((()=>t.orderInfo),(e=>{var l;null==(l=v.value)||l.refresh({orderId:e.id})}),{deep:!0});const{service:u}=l(),{user:d}=a(),{dict:i}=r(),s=U(1==(null==(n=d.info)?void 0:n.id)),m=e.useUpsert({items:[()=>({label:"会员",prop:"uid",span:12,required:!0,hidden:()=>1!=d.info.id,component:{name:"el-select",props:{}}}),()=>{var e;return{label:"标题",prop:"title",required:!0,component:{name:"el-input",props:{disabled:!s.value&&"update"==(null==(e=m.value)?void 0:e.mode)}}}},()=>{var e;return{label:"项目订单",span:12,prop:"orderCode",component:{name:"el-select",options:[],props:{disabled:!s.value&&"update"==(null==(e=m.value)?void 0:e.mode)}}}},()=>{var e;return{label:"跟踪状态",prop:"state",span:12,hidden:()=>{var e;return"add"==(null==(e=m.value)?void 0:e.mode)},component:{name:"el-select",options:f,props:{disabled:!s.value&&"update"==(null==(e=m.value)?void 0:e.mode)}}}},()=>{var e;return{label:"图片上传",prop:"imgs",component:{name:"cl-upload",props:{disabled:!s.value&&"update"==(null==(e=m.value)?void 0:e.mode),type:"image",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}}},()=>{var e;return{label:"文件上传",prop:"files",component:{name:"cl-upload",props:{disabled:!s.value&&"update"==(null==(e=m.value)?void 0:e.mode),type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}}},()=>{var e;return{label:"备注",prop:"remark",component:{name:"el-input",props:{disabled:!s.value&&"update"==(null==(e=m.value)?void 0:e.mode),type:"textarea",rows:4}}}}],async onOpen(e){var l,o,a,r,n,p,i,s,c,v,f;if(1==d.info.id){const e=await u.base.sys.user.list();null==(l=m.value)||l.setOptions("uid",e.map((e=>({label:e.nickName||"",value:e.id||""})))),"add"==(null==(o=m.value)?void 0:o.mode)&&(null==(a=m.value)||a.setForm("uid",d.info.id))}const y=await u.crm.order.list({projectNum:null==(r=t.orderInfo)?void 0:r.projectNum});null==(n=m.value)||n.setOptions("orderCode",y.map((e=>{const l=b(e.orderType);return{label:(null==l?void 0:l.label)+"-"+e.orderCode+"-"+ie(de(e.remark),10),value:e.orderCode}}))),"add"==(null==(p=m.value)?void 0:p.mode)&&(null==(s=m.value)||s.setTitle(`${null==(i=t.orderInfo)?void 0:i.projectNum}-新增订单`)),"update"==(null==(c=m.value)?void 0:c.mode)&&(null==(f=m.value)||f.setTitle(`${null==(v=t.orderInfo)?void 0:v.projectNum}-编辑订单`))},onSubmit(e,{next:l}){var o,a,r;let n={orderId:null==(o=t.orderInfo)?void 0:o.id,projectNum:null==(a=t.orderInfo)?void 0:a.projectNum};1!=(null==(r=d.info)?void 0:r.id)&&(n.uid=d.info.id),l({...e,...n})}}),c=e.useTable({columns:[{type:"selection"},{label:"会员",prop:"userName"},{label:"标题",prop:"title",showOverflowTooltip:!0},{label:"项目订单",prop:"orderCode"},{label:"跟踪状态",prop:"state"},{label:"备注",prop:"remark",showOverflowTooltip:!0,minWidth:150},{label:"创建时间",prop:"createTime",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",buttons:["edit","slot-reply"]}]}),v=e.useCrud({service:u.crm.dohistory,async onRefresh(e,{render:l}){var o;e.orderId=null==(o=t.orderInfo)?void 0:o.id;const{list:a,pagination:r}=await u.crm.dohistory.page(e);l(a,r)}},(e=>{e.refresh()})),b=e=>{const l=i.get("orderType").value.filter((l=>l.value==e));if(l.length>0)return l[0];const o=i.get("subOrderType").value.filter((l=>l.value==e));return o.length>0?o[0]:{}},f=z([{label:"待处理",type:"danger",value:0},{label:"处理中",type:"warning",value:1},{label:"已完成",type:"success",value:2}]),y=e=>f.filter((l=>l.value==e))[0],h=U(0),g=U(),I=U(!1);return(e,l)=>{const a=w("cl-refresh-btn"),r=w("cl-add-btn"),n=w("cl-multi-delete-btn"),t=w("cl-flex1"),d=w("cl-search-key"),i=w("cl-row"),s=w("el-button"),b=w("el-popconfirm"),f=w("cl-table"),k=w("cl-pagination"),_=w("cl-upsert"),x=w("el-dialog"),T=w("cl-crud");return j(),M(T,{ref_key:"Crud",ref:v},{default:D((()=>[Y(i,null,{default:D((()=>[Y(a),Y(r),Y(n),Y(t),Y(d)])),_:1}),Y(i,null,{default:D((()=>[Y(f,{ref_key:"Table",ref:c,border:!1},{"column-state":D((({scope:e})=>[Y(b,{title:"跟踪状态更新?",onConfirm:l=>(e=>{if(2==e.state)return p({title:"提醒",message:"不可再更新",type:"warning"});e.state<2&&e.state++,u.crm.dohistory.update({...e}).then((()=>{p({title:"成功",message:"状态更新",type:"success"})}))})(e.row)},{reference:D((()=>[Y(s,{text:"",bg:"",type:y(e.row.state).type},{default:D((()=>[C(S(y(e.row.state).label),1)])),_:2},1032,["type"])])),_:2},1032,["onConfirm"])])),"slot-reply":D((({scope:e})=>[Y(s,{text:"",bg:"",type:"warning",onClick:l=>{return o=e.row,I.value=!0,g.value=o,void h.value++;var o}},{default:D((()=>[C(" 反馈 ")])),_:2},1032,["onClick"])])),_:1},512)])),_:1}),Y(i,null,{default:D((()=>[Y(t),Y(k)])),_:1}),Y(_,{ref_key:"Upsert",ref:m},null,512),Y(x,{modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=e=>I.value=e),title:"反馈列表",fullscreen:!0},{default:D((()=>[(j(),M(ye,{orderInfo:o.orderInfo,historyInfo:g.value,key:h.value,style:{height:"80vh"}},null,8,["orderInfo","historyInfo"]))])),_:1},8,["modelValue"])])),_:1},512)}}}),we={style:{padding:"10px 10px 0px 20px",display:"flex","flex-wrap":"wrap","row-gap":"10px"}},Ie=_("div",{class:"divider"},null,-1),je={class:"more"},ke={class:"more_btn"},_e={style:{padding:"0 30px"}},Ye=h({name:"crm-order"}),De=h({...Ye,setup(o){var n;const{dict:t}=r(),{service:d}=l(),{user:i}=a(),s=U(1!=(null==(n=i.info)?void 0:n.id)),m=U(),c=U(),b=U(),f=U(),y=U(),h=U(0),g=U(),N=z([{label:"待处理",type:"danger",value:0},{label:"处理中",type:"warning",value:1},{label:"已完成",type:"success",value:2}]),V=U({});U({});const F=U({}),R=new Date,L=U(W(R).format("YYYY-MM-DD"));U(!1);const A=e.useUpsert({items:[{type:"tabs",props:{labels:[{label:"基础信息",value:"base"},{label:"其他信息",value:"other"},{label:"富文本信息",value:"text"},{label:"人员信息",value:"personnel"},{label:"财务信息",value:"finance"}]}},{label:"下单者",prop:"uid",span:12,required:!0,value:i.info.id,hidden:()=>1!=i.info.id,component:{name:"el-select",props:{clearable:!0}},group:"base"},{label:"项目订单",span:12,prop:"orderCode",hidden:()=>{var e;return"add"==(null==(e=A.value)?void 0:e.mode)},component:{name:"el-input",props:{disabled:()=>{var e;return"add"!==(null==(e=A.value)?void 0:e.mode)}}},group:"base"},{label:"域名归属我司",prop:"isSelf",span:6,value:0,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}},group:"base"},{label:"是否备案",prop:"isIcp",span:6,value:0,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}},group:"base"},()=>{var e;return{label:"域名",prop:"domain",span:24,component:{name:"el-input",props:{type:"textarea",rows:4,disabled:"add"!=(null==(e=A.value)?void 0:e.mode)}},group:"base"}},{label:"新增域名",prop:"newDomain",hidden:()=>{var e;return"add"==(null==(e=A.value)?void 0:e.mode)},component:{name:"slot-newDomain",disabled:()=>{var e;return"update"!==(null==(e=A.value)?void 0:e.mode)}},group:"base"},{label:"客户",prop:"customerId",component:{name:"slot-customerId"},group:"base"},{label:"项目名称",prop:"siteName",required:!0,component:{name:"el-input"},group:"base"},()=>({label:"项目进度",prop:"state",span:12,hidden:()=>{var e;return"add"==(null==(e=A.value)?void 0:e.mode)},component:{name:"el-select",options:N},group:"base"}),{label:"订单类型",prop:"orderType",span:12,required:!0,component:{name:"el-select",options:t.get("orderType")},group:"base"},{label:"主订单到期",prop:"mainEndDate",span:12,hidden:()=>{var e;return"add"==(null==(e=A.value)?void 0:e.mode)},component:{name:"el-input",props:{disabled:!0}},group:"base"},{label:"续费时间",prop:"endDate",span:12,value:W().add(1,"year").format("YYYY-MM-DD"),component:{name:"el-date-picker",props:{type:"date",valueFormat:"YYYY-MM-DD"}},group:"base"},{label:"需求上传",prop:"requirementFiles",component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}},group:"base"},{label:"模板地址",prop:"siteUrl",component:{name:"el-input"},group:"other"},{label:"交单日期",prop:"completeDate",span:12,value:W().add(7,"day").format("YYYY-MM-DD"),component:{name:"el-date-picker",props:{type:"date",valueFormat:"YYYY-MM-DD"}},group:"other"},{label:"联系人",prop:"contactor",span:12,component:{name:"el-input"},group:"other"},{label:"手机",prop:"phone",span:12,component:{name:"el-input"},group:"other"},{label:"公司座机",prop:"tel",span:12,component:{name:"el-input"},group:"other"},{label:"传真",prop:"zipCode",span:12,component:{name:"el-input"},group:"other"},{label:"Email",prop:"email",span:12,component:{name:"el-input"},group:"other"},{label:"QQ",prop:"qq",span:12,component:{name:"el-input"},group:"other"},{label:"地址",prop:"addess",component:{name:"el-input"},group:"other"},{label:"备注",prop:"remark",component:{name:"cl-editor-quill",props:{height:200}},group:"text"},{label:"项目信息",prop:"projectInfo",component:{name:"cl-editor-quill",props:{height:200}},group:"text"},{label:"渠道",prop:"agentId",component:{name:"slot-agentId",options:[],props:{clearable:!0}},group:"personnel"},{label:"客服",prop:"waiterId",span:12,component:{name:"el-select",options:[],props:{clearable:!0}},group:"personnel"},{label:"技术员",prop:"technicianId",span:12,component:{name:"el-select",options:[],props:{clearable:!0}},group:"personnel"},{label:"项目对接人",prop:"siteManagerId",span:12,required:!0,component:{name:"el-select",options:[],props:{clearable:!0}},group:"personnel"},{label:"发票上传",prop:"invoiceImgs",component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}},group:"finance"},{label:"合同上传",prop:"contractFiles",component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}},group:"finance"},{label:"项目总价",prop:"price",span:12,required:!0,component:{name:"el-input",props:{suffixIcon:v}},group:"finance"},{label:"续费价格",prop:"renewal",span:12,required:!0,component:{name:"el-input",props:{suffixIcon:v}},group:"finance"},{label:"返佣",prop:"rebate",span:12,required:!0,value:0,component:{name:"el-input",props:{suffixIcon:v}},group:"finance"}],async onOpen(e){var l,o,a,r,n,t;m.value="",f.value="",c.value="","add"!=(null==(l=A.value)?void 0:l.mode)&&(c.value=e.domain),1==i.info.id&&(null==(o=A.value)||o.setOptions("uid",y.value.map((e=>({label:e.nickName||"",value:e.id||""}))))),"update"==(null==(a=A.value)?void 0:a.mode)&&(await ae(e.customerId),await ne(e.agentId)),null==(r=A.value)||r.setOptions("waiterId",y.value.map((e=>({label:e.nickName||"",value:e.id||""})))),null==(n=A.value)||n.setOptions("technicianId",y.value.map((e=>({label:e.nickName||"",value:e.id||""})))),null==(t=A.value)||t.setOptions("siteManagerId",y.value.map((e=>({label:e.nickName||"",value:e.id||""}))))},onSubmit(e,{next:l}){var o;let a={domain:f.value?f.value:e.domain};1!=(null==(o=i.info)?void 0:o.id)&&(a.uid=i.info.id),(null==e?void 0:e.domain)&&(e.domain=null==e?void 0:e.domain.trim()),l({...e,...a})}}),B=e.useTable({columns:[{type:"selection"},()=>({label:"#",type:"expand",prop:"detail"}),{label:"下单者",prop:"userName",hidden:s},{label:"项目订单",prop:"orderCode"},{label:"域名",prop:"domain",minWidth:150},{label:"网站名称",prop:"siteName",minWidth:200},{label:"项目进度",prop:"state"},{label:"价格",prop:"price"},{label:"续费时间",prop:"endDate"},{label:"创建时间",prop:"createTime",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",buttons:["slot-subOp"],width:260}]}),P=e.useCrud({service:d.crm.order,async onRefresh(e,{render:l}){const{list:o,pagination:a}=await d.crm.order.page(e);l(o,a),F.value=ee(),y.value=await d.base.sys.user.list(),V.value=Q(y.value),b.value=G(y.value)}},(e=>{var l;e.refresh({departmentId:null==(l=i.info)?void 0:l.departmentId})})),G=e=>e.map((e=>({label:e.nickName||"",value:e.id||""}))),Q=e=>{let l={};return e.forEach((e=>{l[e.id]=e.name})),l},H=e.useAdvSearch({items:[()=>({label:"下单者",prop:"uid",hidden:()=>{var e;return 1!=(null==(e=i.info)?void 0:e.id)},component:{name:"cl-select",props:{clearable:!0,options:[...b.value]}}}),()=>({label:"排序",prop:"orderBy",component:{name:"cl-select",props:{clearable:!0,options:[{label:"最近更新",value:"updateTimeDesc"}]}}}),{label:"订单类型",prop:"orderType",component:{name:"el-select",props:{clearable:!0},options:t.get("orderType").value}},{label:"项目进度",prop:"state",component:{name:"el-select",props:{clearable:!0},options:N}},{label:"到期区间",prop:"month",component:{name:"cl-select",props:{options:[{label:"当月",value:"0"},{label:"未来一个月",value:"1"},{label:"未来二个月",value:"2"},{label:"未来三个月",value:"3"},{label:"未来半年",value:"6"},{label:"未来一年",value:"12"}]}}},{label:"时间",prop:"dateTime",component:{name:"el-date-picker",props:{type:"daterange",startPlaceholder:"开始日期",endPlaceholder:"结束日期",value:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}}]}),X=U(!1),Z=U(!1),J=U(!1),K=e=>{if(N.length){const l=N.filter((l=>l.value==e));if(l.length)return l[0]}},ee=()=>{let e=[];return t.get("orderType").value.forEach((l=>{e[null==l?void 0:l.value]=null==l?void 0:l.label})),e},le=U(!1),oe=U([]),ae=async e=>{if(e&&""!==e){le.value=!0;const l=await d.crm.customer.list({keyWord:e});le.value=!1,oe.value=l.map((e=>({label:e.company?e.company+": "+e.customerName:""+e.customerName,value:e.id})))}},re=U([]),ne=async e=>{if(e&&""!==e){le.value=!0;const l=await d.crm.customer.list({keyWord:e});le.value=!1,re.value=l.map((e=>({label:e.company?e.company+": "+e.customerName:""+e.customerName,value:e.id})))}},te=()=>{X.value=!0,g.value={},h.value++};return(e,l)=>{const o=w("cl-refresh-btn"),a=w("cl-add-btn"),r=w("cl-multi-delete-btn"),n=w("cl-search-key"),t=w("cl-adv-btn"),i=w("cl-flex1"),s=w("el-button"),v=w("el-tag"),b=w("el-popconfirm"),y=w("el-popover"),N=w("cl-table"),U=w("cl-row"),z=w("cl-pagination"),R=w("el-input"),W=w("cl-col"),G=w("el-select-v2"),Q=w("cl-upsert"),ee=w("cl-adv-search"),pe=w("cl-crud"),de=I("permission");return j(),M(pe,{ref_key:"Crud",ref:P},{default:D((()=>[_("div",we,[Y(o),Y(a),Y(r,{style:{"margin-right":"10px"}}),Y(n),Y(t),Y(i),Y(s,{type:"info",onClick:te},{default:D((()=>[C("查看子订单")])),_:1})]),Ie,Y(U,null,{default:D((()=>[Y(N,{ref_key:"Table",ref:B,border:!1},{"column-domain":D((({scope:e})=>{var l,o,a,r,n,t;return[""!==(null==(l=e.row)?void 0:l.domain)?(j(!0),k(q,{key:0},O(null==(a=null==(o=e.row)?void 0:o.domain)?void 0:a.split("\n"),((e,l)=>(j(),M(v,{key:l,size:"small",effect:"plain"},{default:D((()=>[C(S(e),1)])),_:2},1024)))),128)):x("",!0),""!==(null==(r=e.row)?void 0:r.subDomain)?(j(!0),k(q,{key:1},O(null==(t=null==(n=e.row)?void 0:n.subDomain)?void 0:t.split("\n"),((e,l)=>(j(),M(v,{key:l,size:"small",effect:"plain"},{default:D((()=>[C(S(e),1)])),_:2},1024)))),128)):x("",!0)]})),"column-state":D((({scope:e})=>{var l,o,a,r;return[2==(null==(l=e.row)?void 0:l.state)?(j(),M(s,{key:0,text:"",bg:"",type:null==(a=K(null==(o=e.row)?void 0:o.state))?void 0:a.type},{default:D((()=>{var l,o;return[C(S(null==(o=K(null==(l=e.row)?void 0:l.state))?void 0:o.label),1)]})),_:2},1032,["type"])):x("",!0),2!=(null==(r=e.row)?void 0:r.state)?(j(),M(b,{key:1,title:"项目进度更新?",onConfirm:l=>(e=>{if(2==e.state)return!1;e.state<2&&e.state++,d.crm.order.update({...e}).then((()=>{p({title:"成功",message:"进度更新",type:"success"})}))})(e.row)},{reference:D((()=>{var l,o;return[Y(s,{text:"",bg:"",type:null==(o=K(null==(l=e.row)?void 0:l.state))?void 0:o.type},{default:D((()=>{var l,o;return[C(S(null==(o=K(null==(l=e.row)?void 0:l.state))?void 0:o.label),1)]})),_:2},1032,["type"])]})),_:2},1032,["onConfirm"])):x("",!0)]})),"column-endDate":D((({scope:e})=>[e.row.endDate?(j(),k("span",{key:0,class:E({textRed:!$(me)(e.row.endDate,L.value)})},S(e.row.endDate),3)):x("",!0)])),"slot-subOp":D((({scope:e})=>[Y(s,{text:"",bg:"",type:"primary",onClick:l=>{return o=e.row,void(null==(a=P.value)||a.rowEdit(o));var o,a}},{default:D((()=>[C("编辑")])),_:2},1032,["onClick"]),Y(s,{text:"",bg:"",type:"info",onClick:l=>{return o=e.row,J.value=!0,g.value=o,void h.value++;var o}},{default:D((()=>[C("跟踪")])),_:2},1032,["onClick"]),Y(y,{placement:"right",width:80,trigger:"click","popper-class":"dzh_popover"},{reference:D((()=>[Y(s,{text:"",bg:"",type:"success"},{default:D((()=>[C("更多")])),_:1})])),default:D((()=>[_("div",je,[T((j(),k("div",ke,[Y(s,{text:"",bg:"",type:"warning",onClick:l=>{return o=e.row,X.value=!0,g.value=o,void h.value++;var o}},{default:D((()=>[C("追加")])),_:2},1032,["onClick"])])),[[de,$(d).crm.order.permission.add]]),T((j(),k("div",null,[Y(s,{text:"",bg:"",type:"danger",onClick:l=>{return o=e.row,Z.value=!0,g.value=o,void h.value++;var o}},{default:D((()=>[C("财务")])),_:2},1032,["onClick"])])),[[de,$(d).crm.finance.permission.page]])])])),_:2},1024)])),"column-detail":D((({scope:e})=>{var l,o,a,r,n,t;return[_("div",_e,[_("p",null,"客户: "+S(null==(l=e.row)?void 0:l.cName),1),_("p",null,"订单类型: "+S(F.value[null==(o=e.row)?void 0:o.orderType]),1),_("p",null,"渠道: "+S(null==(a=e.row)?void 0:a.agentName),1),_("p",null,"客服: "+S(V.value[null==(r=e.row)?void 0:r.waiterId]),1),_("p",null,"技术员: "+S(V.value[null==(n=e.row)?void 0:n.technicianId]),1),_("p",null,"项目对接人: "+S(V.value[null==(t=e.row)?void 0:t.siteManagerId]),1)])]})),_:1},512)])),_:1}),Y(U,null,{default:D((()=>[Y(i),Y(z)])),_:1}),Y(Q,{ref_key:"Upsert",ref:A},{"slot-newDomain":D((({scope:e})=>[Y(U,null,{default:D((()=>[Y(W,{span:18},{default:D((()=>[Y(R,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),placeholder:"不要添加http或https"},null,8,["modelValue"])])),_:1}),Y(W,null,{default:D((()=>[Y(s,{onClick:l=>(e=>{var l;let o="";o=m.value,e&&(o=m.value+"\n"+e),f.value=o.trim().replace(/^https?:\/\//,"").replace(/\/$/,""),null==(l=A.value)||l.setForm("domain",f.value),m.value="",f.value=""})(e.domain)},{default:D((()=>[C("添加")])),_:2},1032,["onClick"])])),_:2},1024),Y(W,null,{default:D((()=>[Y(s,{onClick:l=>{return e.domain,null==(o=A.value)||o.setForm("domain",c.value),void(f.value=c.value);var o}},{default:D((()=>[C("重置")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),"slot-customerId":D((({scope:e})=>[Y(G,{modelValue:e.customerId,"onUpdate:modelValue":l=>e.customerId=l,filterable:"",remote:"","remote-method":ae,clearable:"",options:oe.value,loading:le.value,placeholder:"请输入名称模糊搜索"},null,8,["modelValue","onUpdate:modelValue","options","loading"])])),"slot-agentId":D((({scope:e})=>[Y(G,{modelValue:e.agentId,"onUpdate:modelValue":l=>e.agentId=l,filterable:"",remote:"","remote-method":ne,clearable:"",options:re.value,loading:le.value,placeholder:"请输入名称模糊搜索"},null,8,["modelValue","onUpdate:modelValue","options","loading"])])),_:1},512),Y(ee,{ref_key:"AdvSearch",ref:H},null,512),Y($(u),{modelValue:X.value,"onUpdate:modelValue":l[1]||(l[1]=e=>X.value=e),title:"下级订单",direction:"rtl",size:"100%"},{default:D((()=>[(j(),M(ue,{orderInfo:g.value,key:h.value},null,8,["orderInfo"]))])),_:1},8,["modelValue"]),Y($(u),{modelValue:Z.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Z.value=e),title:"财务列表",direction:"rtl",size:"80%"},{default:D((()=>[(j(),M(ve,{orderInfo:g.value,key:h.value},null,8,["orderInfo"]))])),_:1},8,["modelValue"]),Y($(u),{modelValue:J.value,"onUpdate:modelValue":l[3]||(l[3]=e=>J.value=e),title:"跟踪处理",direction:"rtl",size:"80%"},{default:D((()=>[(j(),M(ge,{orderInfo:g.value,key:h.value},null,8,["orderInfo"]))])),_:1},8,["modelValue"])])),_:1},512)}}});export{De as default};
