import{i as e}from"./index.umd.min-b68308bb.js";import{u as o}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{a as l}from"./element-plus-961823fe.js";import"./store-52839c99.js";import"./index-4d43d044.js";import{_ as a}from"./subTrack.vue_vue_type_script_name_customeer_pro-subTrack_setup_true_lang-7888d976.js";import{f as r,a5 as p,a9 as t,o as s,V as n,W as i,g as u,a as m,c,Z as d,_ as b,X as v,a3 as _,F as j}from"./@vue.runtime-core-dd57a9c9.js";import{r as f,M as g}from"./@vue.reactivity-9aee8bf6.js";import{ak as y}from"./@vue.shared-dddd31b8.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./@vue.runtime-dom-0c977c95.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./lodash-es-8394daf0.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./@element-plus.icons-vue-15072d5d.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const h={style:{padding:"0 30px"}},w={key:0},k={key:0,style:{color:"#d83b01"}},x={key:1,style:{color:"#00b294"}},C={key:2,style:{color:"#ff8c00"}},V={class:"more"},q={class:"more_btn"},T={class:"dialog-footer"},U=r({name:"customer_pro-order"}),z=r({...U,setup(r){const{service:U}=o(),z=e.useForm(),R=f(),E=f({}),F=f(),L=()=>{document.addEventListener("click",I,!1)},O=()=>{document.removeEventListener("click",I,!1)},I=e=>{Z()},N=e.useUpsert({items:[{type:"tabs",props:{labels:[{label:"基础信息",value:"base"},{label:"个人信息",value:"person"},{label:"收款信息",value:"financial"}]}},{label:"学生名称",prop:"name",span:8,component:{name:"el-input"},required:!0,group:"base"},{label:"学生电话",prop:"mobile",span:8,component:{name:"el-input"},required:!0,group:"base"},{label:"接待人员",prop:"receiver",span:8,component:{name:"el-input"},required:!0,group:"base"},{label:"身份证",prop:"idcard_number",span:8,component:{name:"el-input"},required:!0,group:"base"},{label:"性别",prop:"gender",span:8,component:{name:"el-select",options:[{label:"选择",value:"0"},{label:"男",value:"1"},{label:"女",value:"2"}]},required:!0,group:"base"},{label:"意向院校",prop:"school_id",span:8,component:{name:"slot-school_id",options:[]},required:!0,group:"base"},{label:"意向专业",prop:"majors_id",span:8,component:{name:"slot-majors_id",options:[]},required:!0,group:"base"},{label:"报读类型",prop:"majors_type",span:8,component:{name:"el-select",options:[]},required:!0,group:"base"},{label:"报读层次",prop:"degree_id",span:8,component:{name:"el-select",options:[]},required:!0,group:"base"},{label:"通讯地址",prop:"address",span:24,component:{name:"el-input"},group:"person"},{label:"紧急联系人",prop:"emergency_contact",span:12,component:{name:"el-input"},group:"person"},{label:"紧急联系人电话",prop:"emergency_mobile",props:{labelWidth:"130px"},span:12,component:{name:"el-input"},group:"person"},{label:"微信",prop:"wechat",span:8,component:{name:"el-input"},group:"person"},{label:"民族",prop:"nation",span:8,component:{name:"el-input"},group:"person"},{label:"籍贯",prop:"native_place",span:8,component:{name:"el-input"},group:"person"},{label:"政治面貌",prop:"politics_status",span:8,component:{name:"el-input"},group:"person"},{label:"户口性质",prop:"household_type",span:8,component:{name:"el-select"},group:"person"},{label:"户口所在地",prop:"household_address",span:8,component:{name:"el-input"},group:"person"},{label:"是否应届",prop:"freshman",span:8,component:{name:"el-input"},group:"person"},{label:"当前学历",prop:"education",span:8,component:{name:"el-input"},group:"person"},{label:"毕业学校",prop:"graduated_school",span:8,component:{name:"el-input"},group:"person"},{label:"毕业时间",prop:"graduated_date",span:8,component:{name:"el-input"},group:"person"},{label:"备注",prop:"remark",span:24,component:{name:"el-input",props:{type:"textarea",rows:4}},group:"base"},{label:"校方收定位金",prop:"school_payment",span:8,value:0,component:{name:"el-input-number",props:{precision:2,step:.1}},group:"financial"},{label:"自收定位金",prop:"teams_payment",span:8,value:0,component:{name:"el-input-number",props:{precision:2,step:.1}},group:"financial"},{label:"支付编号",prop:"serial",span:8,component:{name:"el-input"},group:"financial"},{label:"缴费凭证",prop:"voucher",span:8,component:{name:"cl-upload"},group:"financial"}],async onOpen(){var e,o,l;J();const a=await U.customer_pro.readtypes.list();null==(e=N.value)||e.setOptions("majors_type",a.map((e=>({label:e.name,value:e.id}))));const r=await U.customer_pro.readdegree.list();null==(o=N.value)||o.setOptions("degree_id",r.map((e=>({label:e.name,value:e.id})))),null==(l=N.value)||l.setOptions("household_type",[{label:"城镇",value:"1"},{label:"农村",value:"2"}])}}),W=e.useTable({columns:[{type:"selection"},()=>({label:"#",type:"expand",prop:"detail"}),{label:"学生名称",prop:"name"},{label:"手机号码",prop:"mobile"},{label:"微信号",prop:"wechat"},{label:"专业",prop:"majors_name"},{label:"专业类型",prop:"majors_type_name"},{label:"报读层次",prop:"degree_name"},{label:"项目",prop:"project_name"},{label:"客服",prop:"services_name"},{label:"审核状态",prop:"audit_status"},{label:"创建时间",prop:"createTime"},{type:"op",width:300,buttons:["slot-op"]}]}),H=e.useCrud({service:U.customer_pro.order,async onRefresh(e,{next:o,render:l}){const{list:a,pagination:r}=await o(e);F.value=a.map((e=>e.id)),l(a,r)}},(e=>{e.refresh()})),M=e=>{var o,l;1==e.audit_status?null==(o=H.value)||o.rowEdit(e):null==(l=H.value)||l.rowInfo(e)},X=f(!1),Z=e=>{for(let o=0;o<F.value.length;o++){const l=F.value[o];l!=e&&E.value[l]&&(E.value[l]=!1)}O()},A=(e,o)=>{var l;E.value[e.id]=!0;let a=!0;3==o&&(a=!1),a?B({id:e.id,audit_status:o,clues_id:e.clues_id}):null==(l=z.value)||l.open({title:"审核失败意见",items:[{label:"审核意见",prop:"audit_note",component:{name:"el-input",props:{type:"textarea",rows:4}}}],on:{submit(l,{close:a}){B({id:e.id,audit_status:o,audit_note:l.audit_note,clues_id:e.clues_id}),a()}}}),Z(e.id)},B=e=>{U.customer_pro.order.verify({...e}).then((e=>{var o;l.success("操作成功"),null==(o=H.value)||o.refresh()})).catch((e=>{l.error(e.message)})).finally((()=>{Z()}))},D=f(),G=f(),J=async()=>{var e;D.value=await U.customer_pro.school.list(),"add"!=(null==(e=N.value)?void 0:e.mode)&&P(D.value[0].id)},K=async e=>{var o;null==(o=N.value)||o.setForm("majors_id",null),P(e)},P=async e=>{G.value=await U.customer_pro.majors.list({schoolId:e})};return(e,o)=>{const l=p("cl-refresh-btn"),r=p("cl-add-btn"),f=p("cl-multi-delete-btn"),F=p("cl-flex1"),I=p("cl-search-key"),B=p("cl-row"),J=p("el-button"),P=p("el-popconfirm"),Q=p("el-popover"),S=p("cl-table"),Y=p("cl-pagination"),$=p("el-option"),ee=p("el-select"),oe=p("cl-upsert"),le=p("cl-dialog"),ae=p("cl-form"),re=p("cl-crud"),pe=t("permission");return s(),n(re,{ref_key:"Crud",ref:H},{default:i((()=>[u(B,null,{default:i((()=>[u(l),u(r),u(f),u(F),u(I)])),_:1}),u(B,null,{default:i((()=>[u(S,{ref_key:"Table",ref:W,border:!1},{"column-detail":i((({scope:e})=>{var o,l,a,r,p,t,n;return[m("div",h,[(null==(o=e.row)?void 0:o.userName)?(s(),c("p",w,"创建者: "+y(null==(l=e.row)?void 0:l.userName),1)):d("",!0),m("p",null,"接待人员: "+y(null==(a=e.row)?void 0:a.receiver),1),m("p",null,"学方收定位金: "+y(null==(r=e.row)?void 0:r.school_payment),1),m("p",null,"自收定位金: "+y(null==(p=e.row)?void 0:p.teams_payment),1),m("p",null,"支付编号: "+y(null==(t=e.row)?void 0:t.serial),1),m("p",null,"备注: "+y(null==(n=e.row)?void 0:n.remark),1)])]})),"column-audit_status":i((({scope:e})=>[1==e.row.audit_status?(s(),c("span",k," 待审核 ")):d("",!0),2==e.row.audit_status?(s(),c("span",x," 审核通过 ")):d("",!0),3==e.row.audit_status?(s(),c("span",C," 审核驳回 ")):d("",!0)])),"slot-op":i((({scope:e})=>[1==e.row.audit_status&&g(U).customer_pro.order._permission.update?(s(),n(J,{key:0,text:"",bg:"",type:"primary",onClick:o=>M(e.row)},{default:i((()=>[b("编辑")])),_:2},1032,["onClick"])):d("",!0),e.row.audit_status>1&&g(U).customer_pro.order._permission.info?(s(),n(J,{key:1,text:"",bg:"",type:"primary",onClick:o=>M(e.row)},{default:i((()=>[b("查看")])),_:2},1032,["onClick"])):d("",!0),g(U).customer_pro.clues._permission.getTrackList?(s(),n(J,{key:2,text:"",bg:"",type:"warning",onClick:o=>{return l=e.row,R.value=l.clues_id,void(X.value=!0);var l}},{default:i((()=>[b("轨迹")])),_:2},1032,["onClick"])):d("",!0),u(Q,{placement:"right",width:80,trigger:"click","popper-class":"dzh_popover",visible:E.value[e.row.id],persistent:!0,onShow:L,onHide:O},{reference:i((()=>[v((s(),n(J,{text:"",bg:"",type:"info",onClick:o=>{return l=e.row,e.column,Z(l.id),void(E.value[l.id]=!E.value[l.id]);var l},disabled:e.row.audit_status>1},{default:i((()=>[b("审核")])),_:2},1032,["onClick","disabled"])),[[pe,g(U).customer_pro.order.permission.verify]])])),default:i((()=>[m("div",V,[m("div",q,[u(P,{title:"确定审核通过吗?",onConfirm:o=>A(e.row,2)},{reference:i((()=>[u(J,{text:"",bg:"",type:"warning"},{default:i((()=>[b("通过")])),_:1})])),_:2},1032,["onConfirm"])]),m("div",null,[u(J,{text:"",bg:"",type:"danger",onClick:o=>A(e.row,3)},{default:i((()=>[b("驳回")])),_:2},1032,["onClick"])])])])),_:2},1032,["visible"])])),_:1},512)])),_:1}),u(B,null,{default:i((()=>[u(F),u(Y)])),_:1}),u(oe,{ref_key:"Upsert",ref:N},{"slot-school_id":i((({scope:e})=>[u(ee,{modelValue:e.school_id,"onUpdate:modelValue":o=>e.school_id=o,onChange:K},{default:i((()=>[(s(!0),c(j,null,_(D.value,(e=>(s(),n($,{key:e.value,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),"slot-majors_id":i((({scope:e})=>[u(ee,{modelValue:e.majors_id,"onUpdate:modelValue":o=>e.majors_id=o},{default:i((()=>[(s(!0),c(j,null,_(G.value,(e=>(s(),n($,{key:e.value,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},512),u(le,{title:"轨迹",modelValue:X.value,"onUpdate:modelValue":o[1]||(o[1]=e=>X.value=e)},{footer:i((()=>[m("div",T,[u(J,{onClick:o[0]||(o[0]=e=>X.value=!1)},{default:i((()=>[b("关闭")])),_:1})])])),default:i((()=>[u(a,{ref:"TrackRef",id:R.value},null,8,["id"])])),_:1},8,["modelValue"]),u(ae,{ref_key:"RejectRef",ref:z},null,512)])),_:1},512)}}});export{z as default};
