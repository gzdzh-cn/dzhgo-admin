import{u as e}from"./component-942ac5f4.js";import{i as t}from"./index.umd.min-b68308bb.js";import{u as s,d as o}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{a as r,e as a}from"./element-plus-961823fe.js";import"./store-52839c99.js";import{a as l,r as i}from"./index-4d43d044.js";import{v as n,w as p}from"./@vue.runtime-dom-0c977c95.js";import{B as m,a6 as d,E as u}from"./@element-plus.icons-vue-15072d5d.js";import{x as c}from"./lodash-es-8394daf0.js";import{f,h as j,a5 as v,a9 as h,o as b,c as y,a as _,g,W as k,X as x,_ as w,V as C,Z as I,aT as T,aS as N}from"./@vue.runtime-core-dd57a9c9.js";import{r as z,M as V}from"./@vue.reactivity-9aee8bf6.js";import{D as $,ak as q}from"./@vue.shared-dddd31b8.js";import{_ as B}from"./vue-qr-c4264fa6.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./js-binary-schema-parser-814ef804.js";const G={class:"dept-tree"},M={class:"dept-tree__header"},E=(e=>(T("data-v-716fde60"),e=e(),N(),e))((()=>_("div",null,"模型类别",-1))),F={class:"dept-tree__op"},S={class:"no"},W=["onContextmenu"],A={class:"dept-tree__node"},D=["onClick"],O=["onClick"],P=f({name:"model-tree"}),R=B(f({...P,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["list-change","refresh","user-add"],setup(f,{emit:T}){const N=f,{service:B,browser:P}=s(),{ViewGroup:R}=e(),U=t.useForm(),X=z([]),Z=z(!1),H=z(!1);function J({data:e}){return e.parentId}function K(e,t){return t.data.parentId}async function L(){Z.value=!0,H.value=!1,await B.cms.model.list().then((e=>{var t;X.value=l(e),(null==(t=R.value)?void 0:t.selected)||Q()})),Z.value=!1}function Q(e){var t,s;if(e||(e=X.value[0]),e){const o=e.children?i(e.children).map((e=>e.id)):[];o.unshift(e.id),T("refresh",{page:1,typeIds:o}),null==(t=R.value)||t.select(e),null==(s=R.value)||s.setTitle(`列表-${e.name}`)}}function Y(e){var t;const s=e.id?"update":"add",o=e.id?"编辑":"新增";null==(t=U.value)||t.open({title:o,width:"550px",props:{labelWidth:"100px"},items:[{label:"类别",prop:"name",component:{name:"el-input"},required:!0},{label:"排序",prop:"orderNum",value:99,component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{submit(t,{done:a,close:l}){B.cms.model[s]({id:e.id,parentId:e.parentId,name:t.name,orderNum:t.orderNum}).then((()=>{r.success(`${o} ${t.name} 成功`),l(),L()})).catch((e=>{r.error(e.message),a()}))}}})}function ee(e){a.confirm(`该操作会删除 “${e.name}” 类别下所有数据，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"取消",distinguishCancelAndClose:!0}).then((()=>{!async function(t){await B.cms.model.delete({ids:[e.id],deletePro:t}).then((()=>{var s,o;(null==(o=null==(s=R.value)?void 0:s.selected)?void 0:o.id)==e.id&&Q(),t?r.success("删除成功"):a.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),L()}(!0)})).catch((e=>{}))}function te(e){e?a.confirm("已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function t(s,o){s.forEach((s=>{s.parentId=o,e.push(s),s.children&&c(s.children)&&t(s.children,s.id)}))}(X.value,null),await B.base.sys.department.order(e.map(((e,t)=>({id:e.id,parentId:e.parentId,orderNum:t})))).then((()=>{r.success("更新排序成功")})).catch((e=>{r.error(e.message)})),L(),H.value=!1})).catch((()=>null)):L()}function se(e,s,r){s||(s=X.value[0]||{});const a=B.cms.model.permission;t.ContextMenu.open(e,{list:[{label:"新增",hidden:r&&r.level>=N.level||!o(a.add),callback(e){Y({title:""}),e()}},{label:"编辑",hidden:!o(a.update),callback(e){Y(s),e()}},{label:"删除",hidden:!o(a.delete),callback(e){ee(s),e()}}]})}return j((function(){L()})),(e,t)=>{const s=v("el-icon"),o=v("el-tooltip"),r=v("el-button"),a=v("el-tree"),l=v("el-scrollbar"),i=v("cl-form"),c=h("loading");return b(),y("div",G,[_("div",M,[E,_("ul",F,[_("li",{onClick:t[0]||(t[0]=e=>Y({name:""}))},[g(o,{content:"新增"},{default:k((()=>[g(s,null,{default:k((()=>[g(V(m))])),_:1})])),_:1})]),_("li",{onClick:t[1]||(t[1]=e=>L())},[g(o,{content:"刷新"},{default:k((()=>[g(s,null,{default:k((()=>[g(V(d))])),_:1})])),_:1})]),x(_("li",S,[g(r,{onClick:t[2]||(t[2]=e=>te(!0)),size:"small"},{default:k((()=>[w("保存")])),_:1}),g(r,{onClick:t[3]||(t[3]=e=>te(!1)),size:"small"},{default:k((()=>[w("取消")])),_:1})],512),[[n,H.value]])])]),_("div",{class:"dept-tree__container",onContextmenu:p(se,["stop","prevent"])},[g(l,null,{default:k((()=>[x((b(),C(a,{"node-key":"id","default-expand-all":"",data:X.value,props:{label:"name"},draggable:H.value,"allow-drag":J,"allow-drop":K,"expand-on-click-node":!1,onNodeContextmenu:se},{default:k((({node:e,data:t})=>{var o,r;return[_("div",A,[_("span",{class:$(["dept-tree__node-label",{"is-active":t.id==(null==(r=null==(o=V(R))?void 0:o.selected)?void 0:r.id)}]),onClick:e=>Q(t)},q(e.label),11,D),V(P).isMini?(b(),y("span",{key:0,class:"dept-tree__node-icon",onClick:s=>se(s,t,e)},[g(s,null,{default:k((()=>[g(V(u))])),_:1})],8,O)):I("",!0)])]})),_:1},8,["data","draggable"])),[[c,Z.value]])])),_:1})],40,W),g(i,{ref_key:"Form",ref:U},null,512)])}}}),[["__scopeId","data-v-716fde60"]]),U=f({name:"cms-field"}),X=f({...U,setup(o){const{service:r}=s(),{ViewGroup:a}=e(),l=t.useUpsert({items:[{label:"标题",prop:"name",required:!0,component:{name:"el-input"}},{label:"字段类型",prop:"fieldTypeId",required:!0,component:{name:"el-select",options:[]}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}},{label:"状态",prop:"status",value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}}}],onOpen(){r.cms.fieldType.list().then((e=>{var t;null==(t=l.value)||t.setOptions("fieldTypeId",e.map((e=>({label:e.name,value:e.id}))))}))},onSubmit(e,{next:t}){var s,o;t({...e,modelTypeId:null==(o=null==(s=a.value)?void 0:s.selected)?void 0:o.id})}}),i=t.useTable({columns:[{type:"selection"},{label:"标题",prop:"name"},{label:"备注",prop:"remark"},{type:"op",buttons:["edit","delete"]}]}),n=t.useCrud({service:r.cms.field});function p(e){var t;null==(t=n.value)||t.refresh(e)}return(e,t)=>{const s=v("cl-refresh-btn"),o=v("cl-add-btn"),r=v("cl-multi-delete-btn"),m=v("cl-flex1"),d=v("cl-search-key"),u=v("cl-row"),c=v("cl-table"),f=v("cl-pagination"),j=v("cl-upsert"),h=v("cl-crud"),y=v("cl-view-group");return b(),C(y,{ref_key:"ViewGroup",ref:a},{left:k((()=>[g(R,{onRefresh:p})])),right:k((()=>[g(h,{ref_key:"Crud",ref:n},{default:k((()=>[g(u,null,{default:k((()=>[g(s),g(o),g(r),g(m),g(d)])),_:1}),g(u,null,{default:k((()=>[g(c,{ref_key:"Table",ref:i},null,512)])),_:1}),g(u,null,{default:k((()=>[g(m),g(f)])),_:1}),g(j,{ref_key:"Upsert",ref:l},null,512)])),_:1},512)])),_:1},512)}}});export{X as default};
