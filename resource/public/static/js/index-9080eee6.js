import{d as e}from"./dayjs-89173748.js";import{j as s,b as a,u as t,m as l,h as i}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import"./element-plus-961823fe.js";import"./store-52839c99.js";import"./index-4d43d044.js";import{J as o,aq as n,ar as r,a6 as c,as as u,at as m,m as d}from"./@element-plus.icons-vue-15072d5d.js";import{M as p,f as v,C as j,a5 as f,a9 as h,X as g,o as y,c as b,a as x,F as _,g as k,Z as w,a3 as z,W as C,_ as M,V,n as T,N as I}from"./@vue.runtime-core-dd57a9c9.js";import{d as N}from"./pinia-efddbf44.js";import{r as q,M as S}from"./@vue.reactivity-9aee8bf6.js";import{i as U}from"./index.umd.min-b68308bb.js";import{k as Y}from"./@vueuse.core-3c960f69.js";import{ak as B,D}from"./@vue.shared-dddd31b8.js";import{_ as H}from"./vue-qr-c4264fa6.js";import{d as J}from"./lodash-es-8394daf0.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./@vue.runtime-dom-0c977c95.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@vueuse.shared-2b88397c.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./vue-demi-71ba0ef2.js";import"./vue-6d1d317a.js";import"./js-binary-schema-parser-814ef804.js";function R(){return{chat:p("chat")}}const F=N("chat-message",(()=>{const e=q(!1),a=q([]),t=q({page:1,total:0,size:20});return{loading:e,list:a,pagination:t,get:async function(l){e.value=!0,1==(null==l?void 0:l.page)&&(a.value=[]),await s.chat.message.page(l).then((e=>{a.value=e.list.map((e=>(e.content=JSON.parse(e.content),e))),t.value=e.pagination})),e.value=!1}}})),W=N("chat-session",(()=>{const e=q(!1),a=q([]),t=q();function l(e){t.value=e}return{loading:e,list:a,value:t,get:async function(i){e.value=!0,await s.chat.session.page(i).then((e=>{t.value||l(e.list[0]),a.value=e.list})),e.value=!1},set:l}}));function X(){return{session:W(),message:F()}}const Z={class:"chat-message","element-loading-text":"消息列表加载中"},A={class:"head"},E={class:"avatar"},G={class:"name"},K={class:"list scroller1"},L={class:"avatar"},O=["onContextmenu"],P={class:"h"},Q={class:"name"},$={class:"content"},ee={key:0,class:"is-text"},se={key:1,class:"is-image"},ae={class:"footer"},te={class:"tools"},le={class:"input"},ie=v({name:"undefined"}),oe=H(v({...ie,setup(e){const{user:s}=a(),{chat:t}=R(),{message:l,session:i}=X(),{copy:c}=Y(),u=q(""),m=j((()=>{let e=0;return l.list.map((a=>{var t;return 1==a.contentType&&(a._index=e++),a.isMy=a.fromId==(null==(t=s.info)?void 0:t.id),a}))})),d=j((()=>l.list.filter((e=>1==e.contentType)).map((e=>{var s;return null==(s=e.content)?void 0:s.imageUrl})).filter(Boolean)));function p(){t.send({contentType:0,content:{text:u.value}},!0),u.value=""}function v(e){t.send({contentType:1,content:{imageUrl:e.url}},!0),u.value=""}return(e,s)=>{var a,t,j,V;const T=f("el-avatar"),I=f("el-image"),N=f("el-icon"),q=f("cl-upload"),Y=f("el-input"),H=f("el-button"),J=h("loading");return g((y(),b("div",Z,[x("div",A,[(null==(a=S(i))?void 0:a.value)?(y(),b(_,{key:0},[x("div",E,[k(T,{size:30,shape:"square",src:null==(t=S(i))?void 0:t.value.avatar},null,8,["src"])]),x("span",G,"与“"+B(null==(j=S(i))?void 0:j.value.nickName)+"”聊天中",1)],64)):w("",!0)]),x("div",K,[x("ul",null,[(y(!0),b(_,null,z(S(m),((e,s)=>(y(),b("li",{key:s},[x("div",{class:D(["item",{"is-right":e.isMy}])},[x("div",L,[k(T,{size:36,shape:"square",src:e.avatar},null,8,["src"])]),x("div",{class:"det",onContextmenu:s=>{!function(e,s){U.ContextMenu.open(e,{hover:{target:"content"},list:[{label:"复制",callback(e){c(s.content.text||""),e()}},{label:"转发"},{label:"删除"}]})}(s,e)}},[x("div",P,[x("span",Q,B(e.nickName),1)]),x("div",$,[0==e.contentType?(y(),b("div",ee,[x("span",null,B(e.content.text),1)])):1==e.contentType?(y(),b("div",se,[k(I,{src:e.content.imageUrl,"preview-src-list":S(d),"initial-index":e._index,"scroll-container":".chat-message .list"},null,8,["src","preview-src-list","initial-index"])])):w("",!0)])],40,O)],2)])))),128))])]),x("div",ae,[x("div",te,[x("ul",null,[k(q,{onSuccess:v,"show-file-list":!1},{default:C((()=>[x("li",null,[k(N,null,{default:C((()=>[k(S(o))])),_:1})])])),_:1}),x("li",null,[k(N,null,{default:C((()=>[k(S(n))])),_:1})]),x("li",null,[k(N,null,{default:C((()=>[k(S(r))])),_:1})])])]),x("div",le,[k(Y,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=e=>u.value=e),type:"textarea",rows:4,resize:"none",autosize:{minRows:4,maxRows:10},placeholder:"输入内容"},null,8,["modelValue"]),k(H,{size:"small",type:"success",onClick:p,disabled:!u.value},{default:C((()=>[M("发送")])),_:1},8,["disabled"])])])])),[[J,null==(V=S(l))?void 0:V.loading]])}}}),[["__scopeId","data-v-29a48b6e"]]),ne={class:"chat-session"},re={class:"head"},ce={class:"tools"},ue={class:"list"},me=["onClick"],de={class:"avatar"},pe={class:"det"},ve={class:"name"},je={class:"message"},fe={class:"status"},he={class:"date"},ge=v({name:"undefined"}),ye=H(v({...ge,setup(e){const{chat:s}=R(),{session:a,message:t}=X(),l=q(""),i=j((()=>(null==a?void 0:a.list.filter((e=>{var s;return null==(s=e.nickName)?void 0:s.includes(l.value)})))||[]));return(e,o)=>{var n;const r=f("el-input"),u=f("el-icon"),m=f("el-avatar"),d=f("el-badge"),p=f("el-empty"),v=f("el-scrollbar"),j=h("loading");return y(),b("div",ne,[x("div",re,[k(r,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=e=>l.value=e),placeholder:"关键字搜索",clearable:""},null,8,["modelValue"]),x("ul",ce,[x("li",{onClick:o[1]||(o[1]=e=>S(a).get())},[k(u,{size:16},{default:C((()=>[k(S(c))])),_:1})])])]),g((y(),b("div",ue,[k(v,{class:"scroller"},{default:C((()=>[(y(!0),b(_,null,z(S(i),((e,l)=>{var i,o;return y(),b("div",{class:D(["item",{"is-active":e.id==(null==(o=null==(i=S(a))?void 0:i.value)?void 0:o.id)}]),key:l,onClick:l=>async function(e){s.expand(!1),a.set(e),await t.get({page:1}),s.scrollToBottom()}(e)},[x("div",de,[k(d,{value:e.num,hidden:0==e.num},{default:C((()=>[k(m,{shape:"square",src:e.avatar},null,8,["src"])])),_:2},1032,["value","hidden"])]),x("div",pe,[x("p",ve,B(e.nickName),1),x("p",je,B(e.text),1)]),x("div",fe,[x("p",he,B(e.createTime),1)])],10,me)})),128)),0==S(i).length?(y(),V(p,{key:0,"image-size":100,description:"暂无会话"})):w("",!0)])),_:1})])),[[j,null==(n=S(a))?void 0:n.loading]])])}}}),[["__scopeId","data-v-f1175bed"]]),be={class:"cl-chat__wrap"},xe={class:"cl-chat__session"},_e={class:"cl-chat__right"},ke={class:"cl-dialog__controls-icon"},we=v({name:"cl-chat"}),ze=v({...we,setup(s,{expose:o}){t();const{browser:n,onScreenChange:r}=i(),{session:c,message:p}=X(),{user:v}=a();l.get("chat");const j=q(!1),h=q(!0),g=q(parseInt(String(100*Math.random())));function _(){!async function(){await c.get(),await p.get(),M()}()}function w(){j.value=!0,_()}function z(s){var a,t,l,i;p.list.push({fromId:null==(a=v.info)?void 0:a.id,toId:null==(t=c.value)?void 0:t.userId,avatar:null==(l=v.info)?void 0:l.headImg,nickName:null==(i=v.info)?void 0:i.nickName,createTime:e().format("YYYY-MM-DD HH:mm:ss"),...s}),M()}const M=J((()=>{T((()=>{const e=document.querySelector(".cl-chat .chat-message .list");null==e||e.scroll({top:1e5+Math.random(),behavior:"smooth"})}))}),300);return I("chat",{get socket(){},send:function(e,s){s&&z(e)},append:z,expand:function(e){h.value=void 0===e?!h.value:e},scrollToBottom:M}),r((()=>{h.value=!n.isMini})),o({open:w,close:function(){j.value=!1}}),(e,s)=>{const a=f("el-icon"),t=f("el-badge"),l=f("cl-dialog");return y(),b("div",be,[x("div",{class:"cl-chat__icon",onClick:w},[k(t,{value:g.value},{default:C((()=>[k(a,{size:15},{default:C((()=>[k(S(u))])),_:1})])),_:1},8,["value"])]),k(l,{modelValue:j.value,"onUpdate:modelValue":s[2]||(s[2]=e=>j.value=e),title:"聊天窗口",height:"630px",width:"1200px","keep-alive":"","close-on-click-modal":!1,"close-on-press-escape":"","append-to-body":"",controls:["slot-expand","cl-flex1","fullscreen","close"]},{"slot-expand":C((()=>[x("button",ke,[h.value?(y(),V(a,{key:1,onClick:s[1]||(s[1]=e=>h.value=!1)},{default:C((()=>[k(S(d))])),_:1})):(y(),V(a,{key:0,onClick:s[0]||(s[0]=e=>h.value=!0)},{default:C((()=>[k(S(m))])),_:1}))])])),default:C((()=>[x("div",{class:D(["cl-chat",{"is-mini":S(n).isMini,"is-expand":h.value}])},[x("div",xe,[k(ye)]),x("div",_e,[k(oe)])],2)])),_:1},8,["modelValue"])])}}});export{ze as default};
