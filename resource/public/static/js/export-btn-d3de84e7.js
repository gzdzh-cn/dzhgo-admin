import{i as e}from"./index.umd.min-b68308bb.js";import{F as t}from"./file-saver-38d20b3d.js";import{u as r,w as o,S as i}from"./xlsx-c1873084.js";import{a as s}from"./element-plus-961823fe.js";import{f as a,g as n,_ as l,a5 as p}from"./@vue.runtime-core-dd57a9c9.js";import{r as m,i as c}from"./@vue.reactivity-9aee8bf6.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./@vue.runtime-dom-0c977c95.js";import"./@vue.shared-dddd31b8.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./lodash-es-8394daf0.js";import"./@element-plus.icons-vue-15072d5d.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";function u(){if(!(this instanceof u))return new u;this.SheetNames=[],this.Sheets={}}function f(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),o=0;o!=e.length;++o)r[o]=255&e.charCodeAt(o);return t}function d({multiHeader:e=[],header:s,data:a,filename:n,merges:l=[],autoWidth:p=!0,bookType:m="xlsx"}={}){n=n||"excel-list",(a=[...a]).unshift(s);for(let t=e.length-1;t>-1;t--)a.unshift(e[t]);var c="SheetJS",d=new u,h=function(e,t){for(var o,s={},a={s:{c:1e7,r:1e7},e:{c:0,r:0}},n=0;n!=e.length;++n)for(var l=0;l!=e[n].length;++l){a.s.r>n&&(a.s.r=n),a.s.c>l&&(a.s.c=l),a.e.r<n&&(a.e.r=n),a.e.c<l&&(a.e.c=l);var p={v:e[n][l]};if(null!=p.v){var m=r.encode_cell({c:l,r:n});"number"==typeof p.v?p.t="n":"boolean"==typeof p.v?p.t="b":p.v instanceof Date?(p.t="n",p.z=i._table[14],p.v=(o=p.v,(Date.parse(o)-new Date(Date.UTC(1899,11,30)))/864e5)):p.t="s",s[m]=p}}return a.s.c<1e7&&(s["!ref"]=r.encode_range(a)),s}(a);if(l.length>0&&(h["!merges"]||(h["!merges"]=[]),l.forEach((e=>{h["!merges"].push(r.decode_range(e))}))),p){const e=a.map((e=>e.map((e=>null==e?{wch:10}:e.toString().charCodeAt(0)>255?{wch:2*e.toString().length}:{wch:e.toString().length}))));let t=e[0];for(let r=1;r<e.length;r++)for(let o=0;o<e[r].length;o++)t[o].wch<e[r][o].wch&&(t[o].wch=e[r][o].wch);h["!cols"]=t}d.SheetNames.push(c),d.Sheets[c]=h;var j=o(d,{bookType:m,bookSST:!1,type:"binary"});t.saveAs(new Blob([f(j)],{type:"application/octet-stream"}),`${n}.${m}`)}const h=a({name:"cl-export-btn",props:{filename:[Function,String],autoWidth:{type:Boolean,default:!0},bookType:{type:String,default:"xlsx"},header:Array,columns:{type:Array,required:!0},data:[Function,Array],maxExportLimit:Number},setup(t){const r=m(!1),o=e.useCrud();async function i(){if("function"==typeof t.filename)return await(null==t?void 0:t.filename());{const{year:e,month:r,day:o,hour:i,minu:s,sec:a}=function(){const e=new Date;return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minu:e.getMinutes(),sec:e.getSeconds()}}();return t.filename||`报表（${e}-${r}-${o} ${i}_${s}_${a}）`}}async function a(){if(!t.columns)return;r.value=!0;const e=t.columns.filter((e=>!(!0===e.hidden||["selection","expand","index"].includes(e.type)||e.filterExport||e["filter-export"]))),a=e.map((e=>e.prop)).filter(Boolean),n=await async function(e,t){return e.filter((e=>!e.hidden&&t.includes(e.prop))).map((e=>e.label))}(e,a);let l=await("function"==typeof t.data?t.data():t.data?t.data:null==(m=o.value)?void 0:m.service.page({...null==(p=o.value)?void 0:p.paramsReplace(o.value.params),maxExportLimit:t.maxExportLimit,isExport:!0}).then((e=>e.list.map((e=>{for(const r in e){const o=t.columns.find((e=>e.prop==r));if(o&&(o.formatter&&(e=o.formatter(e)),o.dict)){const t=(c(o.dict)?o.dict.value:o.dict).find((t=>t.value==e[r]));t&&(e[r]=t.label)}}return e})))).catch((e=>(s.error(e.message),null))));var p,m;if(!l)return void(r.value=!1);const u=await i();l=l.map((e=>a.map((t=>e[t])))),d({header:n,data:l,filename:u,autoWidth:t.autoWidth,bookType:t.bookType}),r.value=!1}return()=>n(p("el-button"),{loading:r.value,onClick:a},{default:()=>[n("slot",null,[l("导出")])]})}});export{h as default};
