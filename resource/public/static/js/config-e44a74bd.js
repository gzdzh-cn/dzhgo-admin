import{i as e}from"./index.umd.min-b68308bb.js";import{s as t,u as r}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{g as o}from"./element-plus-961823fe.js";import"./store-52839c99.js";import"./index-4d43d044.js";import{d as s}from"./pinia-efddbf44.js";import{r as p,M as l}from"./@vue.reactivity-9aee8bf6.js";import{f as i,A as a,a5 as n,o as m,V as c,W as u,a as d,g as f,_ as j}from"./@vue.runtime-core-dd57a9c9.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./@vue.runtime-dom-0c977c95.js";import"./@vue.shared-dddd31b8.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./lodash-es-8394daf0.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./@element-plus.icons-vue-15072d5d.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./vue-demi-71ba0ef2.js";const b=t.info(),v=s("config",(function(){const e=p(b.refresh||!1);return{refresh:e,setConfig:r=>{e.value=r,t.set("refresh",r)}}}));const g={style:{padding:"10px 10px 0px 20px",display:"flex","flex-wrap":"wrap","row-gap":"10px"}},h=d("div",{class:"divider"},null,-1),y={class:"more"},x={class:"more_btn"},w=i({name:"fileUpload-config"}),I=i({...w,setup(t){const{service:s}=r(),{config:i}={config:v()},b=p(i.refresh),w=e.useUpsert({items:[{label:"站点名称",prop:"name",required:!0,component:{name:"el-input"}},{label:"站点域名",prop:"siteDomain",required:!0,component:{name:"el-input"}},{label:"站点编号",prop:"itemId",required:!0,component:{name:"el-input-number",props:{min:0}}},{label:"ftp地址",prop:"ftpHost",required:!0,component:{name:"el-input"}},{label:"ftp端口",prop:"ftpPort",required:!0,value:21,component:{name:"el-input"}},{label:"ftp账号",prop:"ftpUser",required:!0,component:{name:"el-input"}},{label:"ftp密码",prop:"ftpPassword",required:!0,component:{name:"el-input"}},{label:"本地根路径",prop:"localRootPath",required:!0,component:{name:"el-input"}},{label:"线上根路径",prop:"remoteRoot",required:!0,component:{name:"el-input",props:{placeholder:"不能为空，根目填写 /"}}},{label:"上传文件夹",prop:"localPathList",required:!0,component:{name:"el-input",props:{placeholder:"多个用英文逗号隔开,支持写文件名称，如 /index.html,/html"}}},{label:"忽略文件",prop:"ignoreList",component:{name:"el-input",props:{placeholder:"多个用英文逗号隔开, 如 .DS_Store, .htaccess, .gitignore"}}},{label:"IP白名单",prop:"siteIp",component:{name:"el-input",props:{placeholder:"多个用英文逗号隔开"}}},{label:"排序",prop:"orderNum",value:99,component:{name:"el-input-number",props:{min:0}},required:!0},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}},()=>({label:"异常信息",prop:"error",hidden(e){var t;return"update"!=(null==(t=w.value)?void 0:t.mode)||""===e.scope.error||null===e.scope.error},value:"",component:{name:"el-input",props:{type:"textarea",rows:4,disabled:!0}}}),{label:"任务状态",prop:"status",value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}}}]}),I=e.useTable({columns:[{type:"selection"},{label:"标题",prop:"name",formatter:(e,t,r,o)=>""!=e.error?r+" - 异常":r},{label:"站点域名",prop:"siteDomain"},{label:"站点编号",prop:"itemId"},{label:"执行开始时间",prop:"uploadStartTime"},{label:"上次结束时间",prop:"uploadEndTime"},{label:"进度值",prop:"percent",formatter:e=>e.percent+"%"},{label:"进度状态",prop:"processStatus",formatter(e){switch(e.processStatus){case 0:return"等待执行";case 1:return"执行中";case 2:return"执行完成";case-1:return"手动停止"}}},{label:"任务状态",prop:"status",component:{name:"cl-switch"}},{label:"创建时间",prop:"createTime"},{type:"op",buttons:["edit","slot-start"]}]}),_=e.useCrud({service:s.fileUpload.config},(e=>{e.refresh()})),k=async(e,t)=>{if("start"==t){if(await s.fileUpload.config.startUpload({itemId:e.itemId})==e.itemId)return void o({title:"提醒",message:"任务执行中",type:"warning"});o({title:"成功",message:"任务开始执行",type:"success"})}"stop"==t&&s.fileUpload.config.stopUploadById({itemId:e.itemId}).then((t=>{o({title:"成功",message:`任务${e.itemId}执行停止`,type:"success"})})).catch((e=>{o({title:"错误",message:e.message,type:"error"})})),setTimeout((()=>{var e;null==(e=_.value)||e.refresh()}),1e3)};let q;a(b,(e=>{i.setConfig(b.value),e?q=setInterval((()=>{var e;null==(e=_.value)||e.refresh()}),5e3):clearInterval(q)}));const U=e=>{var t,r;"start"==e&&(s.fileUpload.config.multiStart({itemIds:null==(t=_.value)?void 0:t.selection.map((e=>e.itemId))}),o({title:"成功",message:"任务开始",type:"success"})),"stop"==e&&(s.fileUpload.config.multiStop({itemIds:null==(r=_.value)?void 0:r.selection.map((e=>e.itemId))}),o({title:"成功",message:"任务停止",type:"success"})),setTimeout((()=>{var e;null==(e=_.value)||e.refresh()}),1e3)};return(e,t)=>{const r=n("cl-refresh-btn"),o=n("cl-add-btn"),s=n("cl-multi-delete-btn"),p=n("el-button"),i=n("el-checkbox"),a=n("cl-flex1"),v=n("cl-search-key"),q=n("cl-adv-btn"),C=n("el-popover"),z=n("cl-table"),S=n("cl-row"),T=n("cl-pagination"),V=n("cl-upsert"),P=n("cl-crud");return m(),c(P,{ref_key:"Crud",ref:_},{default:u((()=>{var e,n;return[d("div",g,[f(r),f(o),f(s,{style:{"margin-right":"10px"}}),f(p,{type:"warning",onClick:t[0]||(t[0]=e=>U("start")),disabled:!(null==(e=l(_))?void 0:e.selection.length)},{default:u((()=>[j("批量启动")])),_:1},8,["disabled"]),f(p,{type:"danger",onClick:t[1]||(t[1]=e=>U("stop")),disabled:!(null==(n=l(_))?void 0:n.selection.length)},{default:u((()=>[j("批量停止")])),_:1},8,["disabled"]),f(i,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=e=>b.value=e),label:"定时刷新",size:"default",border:"",style:{"margin-left":"10px"}},null,8,["modelValue"]),f(a),f(v),f(q)]),h,f(S,null,{default:u((()=>[f(z,{ref_key:"Table",ref:I,border:!1},{"slot-start":u((({scope:e})=>[f(C,{placement:"right",width:80,trigger:"click","popper-class":"dzh_popover"},{reference:u((()=>[f(p,{text:"",bg:"",type:"success"},{default:u((()=>[j("更多")])),_:1})])),default:u((()=>[d("div",y,[d("div",x,[f(p,{text:"",bg:"",type:"warning",onClick:t=>k(e.row,"start")},{default:u((()=>[j("启动")])),_:2},1032,["onClick"])]),d("div",null,[f(p,{text:"",bg:"",type:"danger",onClick:t=>k(e.row,"stop")},{default:u((()=>[j("停止")])),_:2},1032,["onClick"])])])])),_:2},1024)])),_:1},512)])),_:1}),f(S,null,{default:u((()=>[f(a),f(T)])),_:1}),f(V,{ref_key:"Upsert",ref:w},null,512)]})),_:1},512)}}});export{I as default};
