import{v as e}from"./@vue.runtime-dom-0c977c95.js";import{i as l}from"./index.umd.min-b68308bb.js";import{u as o}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{a}from"./element-plus-961823fe.js";import"./store-52839c99.js";import"./index-4d43d044.js";import{_ as t}from"./subTrack.vue_vue_type_script_name_customeer_pro-subTrack_setup_true_lang-7888d976.js";import{M as r}from"./@element-plus.icons-vue-15072d5d.js";import{f as s,a5 as i,a9 as u,o as n,V as p,W as m,g as c,_ as d,X as v,a as b,c as _,Z as j,a3 as f,F as y}from"./@vue.runtime-core-dd57a9c9.js";import{r as g,M as w}from"./@vue.reactivity-9aee8bf6.js";import{ak as h}from"./@vue.shared-dddd31b8.js";import{_ as k}from"./vue-qr-c4264fa6.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./lodash-es-8394daf0.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./js-binary-schema-parser-814ef804.js";const x={style:{padding:"0 30px"}},C={key:0},V={key:1},T={key:0,style:{color:"#d83b01"}},O={key:1,style:{color:"#00b294"}},F={class:"dialog-footer"},I=s({name:"customer_pro-comclues"}),U=k(s({...I,setup(s){const{service:k}=o(),I=g(),U=g(),Y=g(!1),D=g(!0),H=l.useUpsert({items:[()=>({label:"姓名",prop:"name",span:12,component:{name:"el-input"}}),{label:"来源",prop:"source_from",span:12,component:{name:"el-select"}},{label:"手机号",prop:"mobile",span:12,component:{name:"el-input"}},{label:"微信号",prop:"wechat",span:12,component:{name:"el-input"}},{label:"状态",prop:"status",value:0,component:{name:"cl-switch",props:{activeValue:1,inactiveValue:0,activeText:"成交",inactiveText:"未成交",inlinePrompt:!0}}}],async onOpen(e){var l,o,a,t,r,s,i,u,n,p;1!=e.source_from&&(e.name=((null==e?void 0:e.city)?null==e?void 0:e.city:"")+((null==e?void 0:e.guest_id)?null==e?void 0:e.guest_id:""));const m=await k.customer_pro.project.list();null==(l=H.value)||l.setOptions("project_id",m.map((e=>({label:e.name,value:e.id}))));const c=await k.customer_pro.school.list();null==(o=H.value)||o.setOptions("school_id",c.map((e=>({label:e.name,value:e.id}))));const d=await k.customer_pro.majors.list();null==(a=H.value)||a.setOptions("majors_id",d.map((e=>({label:e.name,value:e.id}))));const v=await k.customer_pro.readtypes.list();null==(t=H.value)||t.setOptions("majors_type",v.map((e=>({label:e.name,value:e.id}))));const b=await k.customer_pro.readdegree.list();null==(r=H.value)||r.setOptions("degree_id",b.map((e=>({label:e.name,value:e.id})))),null==(s=H.value)||s.setOptions("household_type",[{label:"城镇",value:"1"},{label:"农村",value:"2"}]),null==(i=H.value)||i.setOptions("level",[{label:"无意向",value:"0"},{label:"无效",value:"1"},{label:"有意向",value:"2"}]),null==(u=H.value)||u.setOptions("gender",[{label:"保密",value:0},{label:"男",value:1},{label:"女",value:2}]),null==(n=H.value)||n.setOptions("source_from",[{label:"手动录入",value:"1"},{label:"百度",value:"2"},{label:"抖音",value:"3"},{label:"53客服",value:"4"},{label:"小红书",value:"5"}]),null==(p=H.value)||p.setOptions("education",[{label:"未知",value:"1"},{label:"初中",value:"2"},{label:"高中/中专/中技",value:"3"},{label:"大专/高技",value:"4"},{label:"本科",value:"5"}])}}),M=l.useTable({columns:[{type:"selection"},()=>({label:"#",type:"expand",prop:"detail"}),{label:"序号",prop:"id"},{label:"项目",prop:"project_name"},{label:"姓名",prop:"name",width:150,formatter:e=>1==e.source_from?e.name:e.city?e.city+e.guest_id:e.guest_id},{label:"手机号",prop:"mobile"},{label:"微信号",prop:"wechat"},{label:"关键词",prop:"keywords"},{label:"跟进状态",prop:"followupType",width:80,dict:[{label:"待跟进",value:"1",type:"danger"},{label:"电话访谈",value:"2",type:"warning"},{label:"微信沟通",value:"3",type:"warning"},{label:"视频参观",value:"4",type:"info"},{label:"预约参观",value:"5",type:"info"},{label:"已参观",value:"6",type:"success"}]},{label:"状态",prop:"status"},{label:"创建时间",prop:"createTime"},{type:"op",width:300,buttons:["slot-op"]}]}),q=l.useCrud({service:k.customer_pro.comClues,async onRefresh(e,{next:l,render:o}){e.oceanTime=!0;const{list:a,pagination:t}=await l(e);o(a,t)}},(e=>{e.refresh()})),z=e=>{var l;null==(l=q.value)||l.refresh(e)},P=l.useForm(),R=async()=>{var e,l,o,t;N.value=[],null==(e=P.value)||e.setForm("group_id",null),W.value=[],null==(l=P.value)||l.setForm("services_id",null),U.value=await k.customer_pro.project.list();const r=null==(o=q.value)?void 0:o.selection.map((e=>e.id));null==(t=P.value)||t.open({title:"分配",items:[{label:"项目",prop:"project_id",component:{name:"slot-project_id"},required:!0},{label:"客服组",prop:"group_id",component:{name:"slot-group_id"},required:!0},{label:"接收人",prop:"services_id",component:{name:"slot-services_id"},required:!0}],on:{async open(){},submit(e,{done:l,close:o}){k.customer_pro.clues.distribute({ids:r,servicesId:e.services_id}).then((()=>{a.success("分配完成"),o(),z()})).catch((e=>{a.error(e.message),l()}))}}})},S=g(),A=e=>{var l,o;N.value=[],null==(l=P.value)||l.setForm("group_id",null),W.value=[],null==(o=P.value)||o.setForm("services_id",null),S.value=e,L(e)},E=e=>{var l;W.value=[],null==(l=P.value)||l.setForm("services_id",null),X(e,S.value)},N=g(),L=async e=>{N.value=await k.customer_pro.project_group.list({projectId:e})},W=g(),X=async(e,l)=>{W.value=await k.customer_pro.kf.list({groupId:e,projectId:l})},Z=g(!1),B=new Date,G=l.useAdvSearch({items:[{label:"跟进状态",prop:"followType",component:{name:"el-select",props:{clearable:!0},options:[{label:"待跟进",value:1},{label:"电话访谈",value:2},{label:"微信沟通",value:3},{label:"视频参观",value:4},{label:"预约参观",value:5},{label:"已参观",value:6}]}},{label:"时间",prop:"datetimerange",component:{name:"el-date-picker",props:{type:"datetimerange",startPlaceholder:"开始日期",endPlaceholder:"结束日期",defaultTime:B,value:"YYYY-MM-DD HH:mm",valueFormat:"YYYY-MM-DD HH:mm",timeFormat:"HH:mm"}}}],op:["reset","close","search"],onSearch(e,{next:l,close:o}){l(e),Y.value=!1,Y.value=Object.values(e).some((e=>{if(e)return!0}))}}),J=e=>{switch(e){case"1":return"手动录入";case"2":return"百度";case"3":return"抖音";case"4":return"53客服";case"5":return"小红书"}},K=()=>"rowColor";return(l,o)=>{const s=i("cl-refresh-btn"),g=i("cl-multi-delete-btn"),S=i("el-button"),L=i("cl-flex1"),X=i("cl-adv-btn"),B=i("cl-search-key"),Q=i("cl-row"),$=i("el-popconfirm"),ee=i("cl-table"),le=i("cl-pagination"),oe=i("cl-upsert"),ae=i("el-option"),te=i("el-select"),re=i("cl-form"),se=i("cl-dialog"),ie=i("cl-adv-search"),ue=i("cl-crud"),ne=u("permission");return n(),p(ue,{ref_key:"Crud",ref:q},{default:m((()=>[c(Q,null,{default:m((()=>{var l;return[c(s),c(g),c(S,{plain:"",onClick:o[0]||(o[0]=e=>(()=>{var e;D.value=!D.value,null==(e=M.value)||e.data.map((e=>{var l;null==(l=M.value)||l.toggleRowExpansion(e,D.value)}))})()),style:{"margin-right":"10px"}},{default:m((()=>[d(h(D.value?"全部收起":"全部展开"),1)])),_:1}),v((n(),p(S,{type:"warning",disabled:0==(null==(l=w(M))?void 0:l.selection.length),onClick:R},{default:m((()=>[d("分配")])),_:1},8,["disabled"])),[[ne,w(k).customer_pro.comClues._permission.distribute]]),c(L),v(c(S,{type:"info",text:"",bg:"",icon:w(r)},{default:m((()=>[d(" 正在搜索中 ")])),_:1},8,["icon"]),[[e,Y.value]]),c(X),c(B)]})),_:1}),c(Q,null,{default:m((()=>[c(ee,{ref_key:"Table",ref:M,border:!1,"default-expand-all":!0,"row-class-name":K},{"column-detail":m((({scope:e})=>{var l,o,a,t,r,s,i,u,p,m,c;return[b("div",x,[(null==(l=e.row)?void 0:l.userName)?(n(),_("p",C,"创建者: "+h(null==(o=e.row)?void 0:o.userName),1)):j("",!0),(null==(a=e.row)?void 0:a.ocean_time)?(n(),_("p",V,"公海时间: "+h(null==(t=e.row)?void 0:t.ocean_time),1)):j("",!0),b("p",null,"账户: "+h(null==(r=e.row)?void 0:r.account_name),1),b("p",null,"来源: "+h(J(null==(s=e.row)?void 0:s.source_from)),1),b("p",null,"IP归属地: "+h(null==(i=e.row)?void 0:i.guest_ip_info),1),b("p",null," 最后跟进时间: "+h((null==(u=e.row)?void 0:u.last_followup_time)?null==(p=e.row)?void 0:p.last_followup_time:null==(m=e.row)?void 0:m.createTime),1),b("p",null,"备注: "+h(null==(c=e.row)?void 0:c.remark),1)])]})),"column-status":m((({scope:e})=>[0==e.row.status?(n(),_("span",T," 未成交 ")):j("",!0),1==e.row.status?(n(),_("span",O," 已成交 ")):j("",!0)])),"slot-op":m((({scope:e})=>[v((n(),p(S,{text:"",bg:"",type:"primary",onClick:l=>{return o=e.row,void("info"==(a="info")?null==(t=q.value)||t.rowInfo(o):"edit"==a&&(null==(r=q.value)||r.rowEdit(o)));var o,a,t,r}},{default:m((()=>[d("查看")])),_:2},1032,["onClick"])),[[ne,w(k).customer_pro.comClues._permission.info]]),v((n(),p(S,{text:"",bg:"",type:"warning",onClick:l=>{return o=e.row,I.value=o.id,void(Z.value=!0);var o}},{default:m((()=>[d("轨迹")])),_:2},1032,["onClick"])),[[ne,w(k).customer_pro.comClues._permission.getTrackList]]),c($,{title:"确定认领该线索吗?",onConfirm:l=>{return o=e.row,void k.customer_pro.clues.claimClues({cluesId:o.id}).then((e=>{a.success("认领成功"),z()})).catch((e=>{a.error(e.message)}));var o}},{reference:m((()=>[v((n(),p(S,{text:"",bg:"",type:"info"},{default:m((()=>[d("认领")])),_:1})),[[ne,w(k).customer_pro.comClues._permission.claimClues]])])),_:2},1032,["onConfirm"])])),_:1},512)])),_:1}),c(Q,null,{default:m((()=>[c(L),c(le)])),_:1}),c(oe,{ref_key:"Upsert",ref:H},null,512),c(re,{ref_key:"DistributeFormRef",ref:P},{"slot-project_id":m((({scope:e})=>[c(te,{modelValue:e.project_id,"onUpdate:modelValue":l=>e.project_id=l,onChange:A},{default:m((()=>[(n(!0),_(y,null,f(U.value,(e=>(n(),p(ae,{key:e.value,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),"slot-group_id":m((({scope:e})=>[c(te,{modelValue:e.group_id,"onUpdate:modelValue":l=>e.group_id=l,onChange:E},{default:m((()=>[(n(!0),_(y,null,f(N.value,(e=>(n(),p(ae,{key:e.value,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),"slot-services_id":m((({scope:e})=>[c(te,{modelValue:e.services_id,"onUpdate:modelValue":l=>e.services_id=l},{default:m((()=>[(n(!0),_(y,null,f(W.value,(e=>(n(),p(ae,{key:e.value,label:e.name,value:e.userId},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},512),c(se,{title:"轨迹",modelValue:Z.value,"onUpdate:modelValue":o[2]||(o[2]=e=>Z.value=e)},{footer:m((()=>[b("div",F,[c(S,{onClick:o[1]||(o[1]=e=>Z.value=!1)},{default:m((()=>[d("关闭")])),_:1})])])),default:m((()=>[c(t,{ref:"TrackRef",id:I.value},null,8,["id"])])),_:1},8,["modelValue"]),c(ie,{ref_key:"AdvSearch",ref:G},null,512)])),_:1},512)}}}),[["__scopeId","data-v-c112bcfb"]]);export{U as default};
