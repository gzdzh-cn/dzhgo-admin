import{i as e}from"./index.umd.min-b68308bb.js";import{u as o,b as r}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import"./element-plus-961823fe.js";import"./store-52839c99.js";import"./index-4d43d044.js";import{f as t,a5 as s,o as i,V as l,W as p,a,g as m}from"./@vue.runtime-core-dd57a9c9.js";import{r as d,M as n}from"./@vue.reactivity-9aee8bf6.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./@vue.runtime-dom-0c977c95.js";import"./@vue.shared-dddd31b8.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./lodash-es-8394daf0.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./@element-plus.icons-vue-15072d5d.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const u={style:{padding:"10px 10px 0px 20px",display:"flex","flex-wrap":"wrap","row-gap":"10px"}},c=a("div",{class:"divider"},null,-1),j=t({name:"crm-reply"}),v=t({...j,setup(t){var j;const{service:v}=o(),{user:b}=r(),f=d(1!=(null==(j=b.info)?void 0:j.id)),y=e.useUpsert({items:[()=>({label:"会员",prop:"uid",span:12,required:!0,hidden:()=>1!=b.info.id,component:{name:"el-select",props:{}}}),{label:"标题",prop:"title",required:!0,component:{name:"el-input"}},{label:"跟踪订单",prop:"historyId",component:{name:"slot-historyId"}},{label:"图片上传",prop:"imgs",component:{name:"cl-upload",props:{type:"image",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"文件上传",prop:"files",component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}}],async onOpen(e){var o,r,t,s;if(1==b.info.id){const e=await v.base.sys.user.list();null==(o=y.value)||o.setOptions("uid",e.map((e=>({label:e.nickName||"",value:e.id||""})))),"add"==(null==(r=y.value)?void 0:r.mode)&&(null==(t=y.value)||t.setForm("uid",b.info.id))}"update"==(null==(s=y.value)?void 0:s.mode)&&await I(e.orderCode)},async onSubmit(e,{next:o}){var r;let t={orderId:x.value[e.historyId].orderId,projectNum:x.value[e.historyId].projectNum,orderCode:x.value[e.historyId].orderCode};1!=(null==(r=b.info)?void 0:r.id)&&(t.uid=b.info.id),o({...e,...t})}}),h=e.useTable({columns:[{type:"selection"},{label:"会员",prop:"userName",hidden:f},{label:"标题",prop:"title"},{label:"备注",prop:"remark",showOverflowTooltip:!0,minWidth:150},{label:"创建时间",prop:"createTime",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",buttons:["edit","delete"]}]}),g=e.useCrud({service:v.crm.reply},(e=>{e.refresh()})),x=d({}),w=d([]),k=d(!1),I=async e=>{if(""!==e){k.value=!0;const o=await v.crm.dohistory.list({keyWord:e});x.value={},k.value=!1,w.value=o.map((e=>(x.value[e.id]=e,{label:e.title+"-"+e.orderCode,value:e.id})))}},C=d(),_=e=>{C.value=e};return(e,o)=>{const r=s("cl-refresh-btn"),t=s("cl-add-btn"),d=s("cl-multi-delete-btn"),j=s("cl-search-key"),v=s("cl-flex1"),b=s("cl-table"),f=s("cl-row"),x=s("cl-pagination"),C=s("el-select-v2"),V=s("cl-upsert"),z=s("cl-crud");return i(),l(z,{ref_key:"Crud",ref:g},{default:p((()=>[a("div",u,[m(r),m(t),m(d,{style:{"margin-right":"10px"}}),m(j),m(v)]),c,m(f,null,{default:p((()=>[m(b,{ref_key:"Table",ref:h,border:!1},null,512)])),_:1}),m(f,null,{default:p((()=>[m(v),m(x)])),_:1}),m(V,{ref_key:"Upsert",ref:y},{"slot-historyId":p((({scope:e})=>{var o;return[m(C,{modelValue:e.historyId,"onUpdate:modelValue":o=>e.historyId=o,filterable:"",remote:"","remote-method":I,onChange:_,clearable:"",options:w.value,loading:k.value,placeholder:"请输入跟踪订单",disabled:"add"!=(null==(o=n(y))?void 0:o.mode)},null,8,["modelValue","onUpdate:modelValue","options","loading","disabled"])]})),_:1},512)])),_:1},512)}}});export{v as default};
