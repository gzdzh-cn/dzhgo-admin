import{i as e}from"./index.umd.min-b68308bb.js";import{u as t,d as l,b as a}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{a as s,e as r}from"./element-plus-961823fe.js";import"./store-52839c99.js";import{a as o,r as n}from"./index-4d43d044.js";import{f as i,A as p,h as d,a5 as m,o as u,c,g as v,a9 as b,a as f,W as h,Z as j,X as y,_ as g,V as k,aT as _,aS as w,a3 as x,F as I}from"./@vue.runtime-core-dd57a9c9.js";import{r as C,M as N}from"./@vue.reactivity-9aee8bf6.js";import{_ as V}from"./vue-qr-c4264fa6.js";import{v as W,w as q}from"./@vue.runtime-dom-0c977c95.js";import{a6 as T,a7 as z,E as A}from"./@element-plus.icons-vue-15072d5d.js";import{u as L}from"./component-942ac5f4.js";import{x as M}from"./lodash-es-8394daf0.js";import{D as B,ak as F}from"./@vue.shared-dddd31b8.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./js-binary-schema-parser-814ef804.js";const S={class:"dept-select"},$=i({name:"dept-select"}),U=V(i({...$,props:{modelValue:[Array,Number,String],multiple:Boolean,checkStrictly:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(e,{emit:l}){const a=e,{service:r}=t(),n=C(),i=C();function b(e){a.multiple||l("update:modelValue",e)}function f(e,{checkedKeys:t}){a.multiple&&l("update:modelValue",t)}return p((()=>a.modelValue),(e=>{n.value=e}),{immediate:!0}),d((()=>{r.base.sys.department.list().then((e=>{i.value=o(e)})).catch((e=>{i.value=[],s.error(e.message)}))})),(t,l)=>{const a=m("el-tree-select");return u(),c("div",S,[v(a,{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=e=>n.value=e),"node-key":"id",data:i.value,props:{label:"name",value:"id",children:"children"},multiple:e.multiple,"check-strictly":e.checkStrictly,"show-checkbox":e.multiple,"default-expand-all":"",onChange:b,onCheck:f},null,8,["modelValue","data","multiple","check-strictly","show-checkbox"])])}}}),[["__scopeId","data-v-6be59c9b"]]),G={class:"dept-move"},E=i({name:"dept-move"}),R=i({...E,setup(l,{expose:a}){const{service:o}=t(),n=e.useForm(),i=e.useCrud();return a({open:async function(e){var t;null==(t=n.value)||t.open({title:"部门转移",width:"500px",props:{labelWidth:"80px"},items:[{label:"选择部门",prop:"departmentId",component:{vm:U}}],on:{submit(t,{done:l,close:a}){if(!t.departmentId)return s.warning("请选择部门"),l();r.confirm("转移到新部门，是否继续？","提示",{type:"warning"}).then((()=>{o.base.sys.user.move({...t,userIds:e}).then((()=>{var e;s.success("转移成功"),null==(e=i.value)||e.refresh(),a()})).catch((e=>{s.error(e.message),l()}))})).catch((()=>null))}}})}}),(e,t)=>{const l=m("cl-form");return u(),c("div",G,[v(l,{ref_key:"Form",ref:n},null,512)])}}}),D={class:"dept-tree"},K={class:"dept-tree__header"},O=(e=>(_("data-v-03398b69"),e=e(),w(),e))((()=>f("div",null,"组织架构",-1))),P={class:"dept-tree__op"},X={class:"no"},Z=["onContextmenu"],H={class:"dept-tree__node"},J=["onClick"],Q=["onClick"],Y=i({name:"dept-tree"}),ee=V(i({...Y,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["list-change","refresh","user-add"],setup(a,{emit:i}){const p=a,{service:_,browser:w}=t(),{ViewGroup:x}=L(),I=e.useForm(),V=C([]),S=C(!1),$=C(!1);function U({data:e}){return e.parentId}function G(e,t){return t.data.parentId}async function E(){S.value=!0,$.value=!1,await _.base.sys.department.list().then((e=>{var t;V.value=o(e),(null==(t=x.value)?void 0:t.selected)||R()})),S.value=!1}function R(e){var t,l;if(e||(e=V.value[0]),e){const a=e.children?n(e.children).map((e=>e.id)):[];a.unshift(e.id),i("refresh",{page:1,departmentIds:a}),null==(t=x.value)||t.select(e),null==(l=x.value)||l.setTitle(`成员列表（${e.name})`)}}function Y(e){var t;const l=e.id?"update":"add";null==(t=I.value)||t.open({title:"编辑部门",width:"550px",props:{labelWidth:"100px"},items:[{label:"部门名称",prop:"name",component:{name:"el-input"},required:!0},{label:"上级部门",prop:"parentName",component:{name:"el-input",props:{disabled:!0}}},{label:"排序",prop:"orderNum",component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{submit(t,{done:a,close:r}){_.base.sys.department[l]({id:e.id,parentId:e.parentId,name:t.name,orderNum:t.orderNum}).then((()=>{s.success(`新增部门 “${t.name}” 成功`),r(),E()})).catch((e=>{s.error(e.message),a()}))}}})}function ee(e){e?r.confirm("部门架构已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function t(l,a){l.forEach((l=>{l.parentId=a,e.push(l),l.children&&M(l.children)&&t(l.children,l.id)}))}(V.value,null),await _.base.sys.department.order(e.map(((e,t)=>({id:e.id,parentId:e.parentId,orderNum:t})))).then((()=>{s.success("更新排序成功")})).catch((e=>{s.error(e.message)})),E(),$.value=!1})).catch((()=>null)):E()}function te(t,a,o){a||(a=V.value[0]||{});const n=_.base.sys.department.permission;e.ContextMenu.open(t,{list:[{label:"新增",hidden:o&&o.level>=p.level||!l(n.add),callback(e){Y({name:"",parentName:a.name,parentId:a.id}),e()}},{label:"编辑",hidden:!l(n.update),callback(e){Y(a),e()}},{label:"删除",hidden:!a.parentId||!l(n.delete),callback(e){!function(e){async function t(t){await _.base.sys.department.delete({ids:[e.id],deleteUser:t}).then((()=>{var l,a;(null==(a=null==(l=x.value)?void 0:l.selected)?void 0:a.id)==e.id&&R(),t?s.success("删除成功"):r.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),E()}r.confirm(`该操作会删除 “${e.name}” 部门的所有用户，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"保留用户",distinguishCancelAndClose:!0}).then((()=>{t(!0)})).catch((e=>{"cancel"==e&&t(!1)}))}(a),e()}},{label:"新增成员",hidden:!l(n.add),callback(e){i("user-add",a),e()}}]})}return d((function(){E()})),(e,t)=>{const l=m("el-icon"),s=m("el-tooltip"),r=m("el-button"),o=m("el-tree"),n=m("el-scrollbar"),i=m("cl-form"),p=b("loading");return u(),c("div",D,[f("div",K,[O,f("ul",P,[f("li",{onClick:t[0]||(t[0]=e=>E())},[v(s,{content:"刷新"},{default:h((()=>[v(l,null,{default:h((()=>[v(N(T))])),_:1})])),_:1})]),a.drag&&!N(w).isMini?(u(),c("li",{key:0,onClick:t[1]||(t[1]=e=>$.value=!0)},[v(s,{content:"拖动排序"},{default:h((()=>[v(l,null,{default:h((()=>[v(N(z))])),_:1})])),_:1})])):j("",!0),y(f("li",X,[v(r,{onClick:t[2]||(t[2]=e=>ee(!0)),size:"small"},{default:h((()=>[g("保存")])),_:1}),v(r,{onClick:t[3]||(t[3]=e=>ee(!1)),size:"small"},{default:h((()=>[g("取消")])),_:1})],512),[[W,$.value]])])]),f("div",{class:"dept-tree__container",onContextmenu:q(te,["stop","prevent"])},[v(n,null,{default:h((()=>[y((u(),k(o,{"node-key":"id","default-expand-all":"",data:V.value,props:{label:"name"},draggable:$.value,"allow-drag":U,"allow-drop":G,"expand-on-click-node":!1,onNodeContextmenu:te},{default:h((({node:e,data:t})=>{var a,s;return[f("div",H,[f("span",{class:B(["dept-tree__node-label",{"is-active":t.id==(null==(s=null==(a=N(x))?void 0:a.selected)?void 0:s.id)}]),onClick:e=>R(t)},F(e.label),11,J),N(w).isMini?(u(),c("span",{key:0,class:"dept-tree__node-icon",onClick:l=>te(l,t,e)},[v(l,null,{default:h((()=>[v(N(A))])),_:1})],8,Q)):j("",!0)])]})),_:1},8,["data","draggable"])),[[p,S.value]])])),_:1})],40,Z),v(i,{ref_key:"Form",ref:I},null,512)])}}}),[["__scopeId","data-v-03398b69"]]),te=i({name:"sys-user"}),le=i({...te,setup(s){const{service:r,refs:o,setRefs:n}=t(),{ViewGroup:i}=L(),{user:p}=a(),d=r.base.sys.role.permission,f=e.useUpsert({dialog:{width:"800px"},items:[{prop:"headImg",label:"头像",component:{name:"cl-upload",props:{text:"选择头像"}}},()=>({prop:"name",label:"姓名",span:12,required:!0,component:{name:"el-input"}}),{prop:"nickName",label:"昵称",required:!0,span:12,component:{name:"el-input"}},{prop:"username",label:"用户名",required:!0,span:12,component:{name:"el-input"}},()=>{var e;return{prop:"password",label:"密码",span:12,required:"add"==(null==(e=f.value)?void 0:e.mode),component:{name:"el-input",props:{type:"password"}},rules:[{min:6,max:16,message:"密码长度在 6 到 16 个字符"}]}},()=>({prop:"roleIdList",label:"角色",value:[],required:!0,hidden:({scope:e})=>!l(d.list)||e.roleIdList.length>0&&e.roleIdList.includes("1"),component:{name:"el-select",options:[],props:{multiple:!0,"multiple-limit":3}}}),{prop:"phone",label:"手机号码",span:12,component:{name:"el-input"}},{prop:"email",label:"邮箱",span:12,component:{name:"el-input"}},{prop:"remark",label:"备注",component:{name:"el-input",props:{type:"textarea",rows:4}}},{prop:"status",label:"状态",value:1,component:{name:"el-radio-group",options:[{label:"开启",value:1},{label:"关闭",value:0}]}}],onSubmit(e,{next:t}){var l,a;t({...e,departmentId:null==(a=null==(l=i.value)?void 0:l.selected)?void 0:a.id})},async onOpen(){l(d.list)&&r.base.sys.role.list().then((e=>{var t;null==(t=f.value)||t.setOptions("roleIdList",e.map((e=>({label:e.name||"",value:e.id}))))}))}}),_=e.useTable({columns:[{type:"selection",width:60},{prop:"headImg",label:"头像",component:{name:"cl-avatar"}},{prop:"username",label:"用户名",minWidth:150},{prop:"name",label:"姓名",minWidth:150},{prop:"nickName",label:"昵称",minWidth:150},{prop:"departmentName",label:"部门名称",minWidth:150},{prop:"roleName",label:"角色",headerAlign:"center",minWidth:120,formatter(e,t,l,a){var s;return 1==(null==(s=p.info)?void 0:s.id)?"超管":l}},{prop:"status",label:"登录状态",minWidth:120,component:{name:"cl-switch",props:{activeValue:1,inactiveValue:0,activeText:"开启",inactiveText:"禁用",inlinePrompt:!0}}},{prop:"phone",label:"手机号码",minWidth:150},{prop:"remark",label:"备注",minWidth:150},{prop:"createTime",label:"创建时间",sortable:"desc",minWidth:160},{type:"op",buttons:["slot-btn","edit","slot-delete"],width:240}]}),w=e.useCrud({service:r.base.sys.user});function C(e){var t;null==(t=w.value)||t.refresh(e)}function V({id:e}){var t;null==(t=w.value)||t.rowAppend({departmentId:e})}async function W(e){var t;let l=[];l=e?[e.id]:(null==(t=_.value)?void 0:t.selection.map((e=>e.id)))||[],o.deptMove.open(l)}return(e,t)=>{const l=m("cl-refresh-btn"),a=m("cl-add-btn"),s=m("cl-multi-delete-btn"),o=m("el-button"),p=m("cl-flex1"),d=m("cl-search-key"),q=m("cl-row"),T=m("el-tag"),z=m("el-popconfirm"),A=m("cl-table"),L=m("cl-pagination"),M=m("cl-upsert"),B=m("cl-crud"),S=m("cl-view-group"),$=b("permission");return u(),k(S,{ref_key:"ViewGroup",ref:i,leftWidth:"20%"},{left:h((()=>[v(ee,{onRefresh:C,onUserAdd:V})])),right:h((()=>[v(B,{ref_key:"Crud",ref:w},{default:h((()=>[v(q,null,{default:h((()=>{var e;return[v(l),v(a),v(s),y((u(),k(o,{type:"success",disabled:0==(null==(e=N(_))?void 0:e.selection.length),onClick:t[0]||(t[0]=e=>W())},{default:h((()=>[g("转移")])),_:1},8,["disabled"])),[[$,N(r).base.sys.user.permission.move]]),v(p),v(d,{placeholder:"搜索用户名、姓名"})]})),_:1}),v(q,null,{default:h((()=>[v(A,{ref_key:"Table",ref:_},{"column-roleName":h((({scope:e})=>[e.row.roleName?(u(!0),c(I,{key:0},x(e.row.roleName.split(","),((e,t)=>(u(),k(T,{key:t,"disable-transitions":"",size:"small",effect:"dark",style:{margin:"2px"}},{default:h((()=>[g(F(e),1)])),_:2},1024)))),128)):j("",!0)])),"slot-btn":h((({scope:e})=>[y((u(),k(o,{text:"",bg:"",onClick:t=>W(e.row)},{default:h((()=>[g("转移")])),_:2},1032,["onClick"])),[[$,N(r).base.sys.user.permission.move]])])),"slot-delete":h((({scope:e})=>[v(z,{title:"确定删除会员吗?",onConfirm:t=>(e=>{let t=[e.id];r.base.sys.user.delete({ids:t}),C()})(e.row)},{reference:h((()=>[y((u(),k(o,{text:"",bg:"",type:"danger"},{default:h((()=>[g("删除")])),_:2},1024)),[[$,N(r).base.sys.user.permission.delete&&e.row.roleIdList.length>0&&!e.row.roleIdList.includes("1")]])])),_:2},1032,["onConfirm"])])),_:1},512)])),_:1}),v(q,null,{default:h((()=>[v(p),v(L)])),_:1}),v(M,{ref_key:"Upsert",ref:f},null,512),v(R,{ref:N(n)("deptMove")},null,512)])),_:1},512)])),_:1},512)}}});export{le as default};
