import{u as e}from"./component-942ac5f4.js";import{i as t}from"./index.umd.min-b68308bb.js";import{u as o,d as a}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{a as r,e as l}from"./element-plus-961823fe.js";import"./store-52839c99.js";import{a as s,r as n}from"./index-4d43d044.js";import{v as i,w as p}from"./@vue.runtime-dom-0c977c95.js";import{B as m,a6 as c,E as d}from"./@element-plus.icons-vue-15072d5d.js";import{x as u}from"./lodash-es-8394daf0.js";import{f as j,h as f,a5 as v,a9 as b,o as h,c as y,a as _,g,W as k,X as x,_ as w,V as C,Z as I,aT as T,aS as N}from"./@vue.runtime-core-dd57a9c9.js";import{r as z,M as V}from"./@vue.reactivity-9aee8bf6.js";import{D as $,ak as q}from"./@vue.shared-dddd31b8.js";import{_ as B}from"./vue-qr-c4264fa6.js";import"./array.prototype.flat-eee42aa4.js";import"./define-properties-b1343066.js";import"./object-keys-e5f060db.js";import"./has-property-descriptors-6845433e.js";import"./get-intrinsic-cff09dfa.js";import"./has-symbols-a48c7173.js";import"./function-bind-cd5d7d08.js";import"./has-3a5c7287.js";import"./call-bind-cfba7623.js";import"./es-abstract-253c30b8.js";import"./has-proto-93b28181.js";import"./gopd-1516b43e.js";import"./is-regex-74a42cfc.js";import"./has-tostringtag-ad4fd641.js";import"./is-callable-99eeba16.js";import"./object-inspect-66cad57c.js";import"./es-to-primitive-6664914a.js";import"./is-date-object-d2231eea.js";import"./is-symbol-3a29a1ce.js";import"./safe-regex-test-183ad494.js";import"./es-shim-unscopables-89146e87.js";import"./vue-6d1d317a.js";import"./vue-router-17136280.js";import"./monaco-editor-c28fb00f.js";import"./axios-6b2fb661.js";import"./nprogress-64657d8f.js";import"./@vueuse.core-3c960f69.js";import"./@vueuse.shared-2b88397c.js";import"./pinia-efddbf44.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-0b3ee9ca.js";import"./merge-4bdec194.js";import"./mitt-2d52b530.js";import"./clone-deep-53153407.js";import"./shallow-clone-d419fbda.js";import"./kind-of-d78bf752.js";import"./is-plain-object-40c8282f.js";import"./isobject-c886ab54.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@ctrl.tinycolor-d9b9bf03.js";import"./@popperjs.core-b696b006.js";import"./dayjs-89173748.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./js-binary-schema-parser-814ef804.js";const G={class:"dept-tree"},M={class:"dept-tree__header"},E=(e=>(T("data-v-bb72c39a"),e=e(),N(),e))((()=>_("div",null,"栏目类别",-1))),F={class:"dept-tree__op"},S={class:"no"},W=["onContextmenu"],A={class:"dept-tree__node"},D=["onClick"],P=["onClick"],R=j({name:"content-tree"}),U=B(j({...R,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["list-change","refresh","user-add"],setup(j,{emit:T}){const N=j,{service:B,browser:R}=o(),{ViewGroup:U}=e(),X=t.useForm(),Z=z([]),H=z(!1),J=z(!1);function K({data:e}){return e.parentId}function L(e,t){return t.data.parentId}async function O(){H.value=!0,J.value=!1,await B.cms.contentType.list().then((e=>{var t;Z.value=s(e),(null==(t=U.value)?void 0:t.selected)||Q()})),H.value=!1}function Q(e){var t,o;if(e||(e=Z.value[0]),e){const a=e.children?n(e.children).map((e=>e.id)):[];a.unshift(e.id),T("refresh",{page:1,typeIds:a}),null==(t=U.value)||t.select(e),null==(o=U.value)||o.setTitle(`列表-${e.name}`)}}function Y(e){var t;const o=e.id?"update":"add",a=e.id?"编辑":"新增";null==(t=X.value)||t.open({title:a,width:"550px",props:{labelWidth:"100px"},items:[{label:"类别",prop:"name",component:{name:"el-input"},required:!0},{label:"模型",prop:"modelId",required:!0,component:{name:"el-select",options:[],props:{clearable:!0,placeholder:"请选择模型"}}},{label:"排序",prop:"orderNum",value:99,component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{open(){B.cms.model.list().then((e=>{var t;null==(t=X.value)||t.setOptions("modelId",e.map((e=>({label:e.name,value:e.id}))))}))},submit(t,{done:l,close:s}){B.cms.contentType[o]({id:e.id,parentId:e.parentId,name:t.name,orderNum:t.orderNum,modelId:t.modelId}).then((()=>{r.success(`${a} ${t.name} 成功`),s(),O()})).catch((e=>{r.error(e.message),l()}))}}})}function ee(e){l.confirm(`该操作会删除 “${e.name}” 类别下所有数据，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"取消",distinguishCancelAndClose:!0}).then((()=>{!async function(t){await B.cms.contentType.delete({ids:[e.id],deletePro:t}).then((()=>{var o,a;(null==(a=null==(o=U.value)?void 0:o.selected)?void 0:a.id)==e.id&&Q(),t?r.success("删除成功"):l.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),O()}(!0)})).catch((e=>{}))}function te(e){e?l.confirm("已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function t(o,a){o.forEach((o=>{o.parentId=a,e.push(o),o.children&&u(o.children)&&t(o.children,o.id)}))}(Z.value,null),await B.base.sys.department.order(e.map(((e,t)=>({id:e.id,parentId:e.parentId,orderNum:t})))).then((()=>{r.success("更新排序成功")})).catch((e=>{r.error(e.message)})),O(),J.value=!1})).catch((()=>null)):O()}function oe(e,o,r){o||(o=Z.value[0]||{});const l=B.cms.contentType.permission;t.ContextMenu.open(e,{list:[{label:"新增",hidden:r&&r.level>=N.level||!a(l.add),callback(e){Y({title:""}),e()}},{label:"编辑",hidden:!a(l.update),callback(e){Y(o),e()}},{label:"删除",hidden:!a(l.delete),callback(e){ee(o),e()}}]})}return f((function(){O()})),(e,t)=>{const o=v("el-icon"),a=v("el-tooltip"),r=v("el-button"),l=v("el-tree"),s=v("el-scrollbar"),n=v("cl-form"),u=b("loading");return h(),y("div",G,[_("div",M,[E,_("ul",F,[_("li",{onClick:t[0]||(t[0]=e=>Y({name:""}))},[g(a,{content:"新增"},{default:k((()=>[g(o,null,{default:k((()=>[g(V(m))])),_:1})])),_:1})]),_("li",{onClick:t[1]||(t[1]=e=>O())},[g(a,{content:"刷新"},{default:k((()=>[g(o,null,{default:k((()=>[g(V(c))])),_:1})])),_:1})]),x(_("li",S,[g(r,{onClick:t[2]||(t[2]=e=>te(!0)),size:"small"},{default:k((()=>[w("保存")])),_:1}),g(r,{onClick:t[3]||(t[3]=e=>te(!1)),size:"small"},{default:k((()=>[w("取消")])),_:1})],512),[[i,J.value]])])]),_("div",{class:"dept-tree__container",onContextmenu:p(oe,["stop","prevent"])},[g(s,null,{default:k((()=>[x((h(),C(l,{"node-key":"id","default-expand-all":"",data:Z.value,props:{label:"name"},draggable:J.value,"allow-drag":K,"allow-drop":L,"expand-on-click-node":!1,onNodeContextmenu:oe},{default:k((({node:e,data:t})=>{var a,r;return[_("div",A,[_("span",{class:$(["dept-tree__node-label",{"is-active":t.id==(null==(r=null==(a=V(U))?void 0:a.selected)?void 0:r.id)}]),onClick:e=>Q(t)},q(e.label),11,D),V(R).isMini?(h(),y("span",{key:0,class:"dept-tree__node-icon",onClick:o=>oe(o,t,e)},[g(o,null,{default:k((()=>[g(V(d))])),_:1})],8,P)):I("",!0)])]})),_:1},8,["data","draggable"])),[[u,H.value]])])),_:1})],40,W),g(n,{ref_key:"Form",ref:X},null,512)])}}}),[["__scopeId","data-v-bb72c39a"]]),X=j({name:"cms-content"}),Z=j({...X,setup(a){const{service:r}=o(),{ViewGroup:l}=e(),s=t.useUpsert({items:[{label:"名称",prop:"name",required:!0,component:{name:"el-input"}},{label:"图片",prop:"img",component:{name:"cl-upload"}},{label:"点击量",prop:"click",value:0,component:{name:"el-input-number",props:{min:0}}},{label:"内容",prop:"content",component:{name:"cl-editor-wang"}},{label:"状态",prop:"status",value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}}}],onSubmit(e,{next:t}){var o,a;t({...e,typeId:null==(a=null==(o=l.value)?void 0:o.selected)?void 0:a.id})}}),n=t.useTable({columns:[{type:"selection"},{label:"名称",prop:"name"},{label:"点击量",prop:"click"},{label:"排序",prop:"orderNum"},{label:"创建时间",prop:"createTime"},{type:"op",buttons:["edit","delete"]}]}),i=t.useCrud({service:r.cms.content});function p(e){var t;null==(t=i.value)||t.refresh(e)}return(e,t)=>{const o=v("cl-refresh-btn"),a=v("cl-add-btn"),r=v("cl-multi-delete-btn"),m=v("cl-flex1"),c=v("cl-search-key"),d=v("cl-row"),u=v("cl-table"),j=v("cl-pagination"),f=v("cl-upsert"),b=v("cl-crud"),y=v("cl-view-group");return h(),C(y,{ref_key:"ViewGroup",ref:l},{left:k((()=>[g(U,{onRefresh:p})])),right:k((()=>[g(b,{ref_key:"Crud",ref:i},{default:k((()=>[g(d,null,{default:k((()=>[g(o),g(a),g(r),g(m),g(c)])),_:1}),g(d,null,{default:k((()=>[g(u,{ref_key:"Table",ref:n},null,512)])),_:1}),g(d,null,{default:k((()=>[g(m),g(j)])),_:1}),g(f,{ref_key:"Upsert",ref:s},null,512)])),_:1},512)])),_:1},512)}}});export{Z as default};
