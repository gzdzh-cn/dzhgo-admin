import{al as e,am as l,ai as a,ah as s,an as t}from"./@element-plus.icons-vue-15072d5d.js";import{u as i}from"./index-c06e60a9.js";import"./vue-echarts-11c03c89.js";import{a as n,e as o}from"./element-plus-961823fe.js";import"./store-52839c99.js";import{e as r}from"./index-4d43d044.js";import{u as c}from"./component-942ac5f4.js";import{w as u}from"./@vue.runtime-dom-0c977c95.js";import{i as p}from"./index.umd.min-b68308bb.js";import{M as d,f as v,C as m,h as f,a5 as y,o as g,c as _,a as h,g as k,W as b,_ as x,F as j,a3 as w,V as C,Z as I,aT as V,aS as z,A as D,a9 as M,X as P,N as T}from"./@vue.runtime-core-dd57a9c9.js";import{r as E,M as F,h as O}from"./@vue.reactivity-9aee8bf6.js";import{D as S,ak as q,F as A}from"./@vue.shared-dddd31b8.js";import{_ as G}from"./vue-qr-c4264fa6.js";import{f as N,_ as U,a as $}from"./viewer.vue_vue_type_script_setup_true_name_item-viewer_lang-7e2cce89.js";import{k as B}from"./@vueuse.core-3c960f69.js";function R(){return{space:d("space")}}const W={class:"item-category"},X={class:"item-category__head"},Z=(e=>(V("data-v-6b2853a3"),e=e(),z(),e))((()=>h("span",null,"类型",-1))),H={class:"item-category__list"},J=["onClick","onContextmenu"],K=v({name:"item-category"}),L=G(v({...K,setup(a){const{service:s}=i(),{space:t}=R(),{ViewGroup:r}=c(),d=p.useForm(),v=E([]),V=E(""),z=m((()=>v.value.filter((e=>(e.name||"").includes(V.value)))));async function D(){return s.space.type.list({order:"createTime",sort:"asc"}).then((e=>{var l;e.unshift({name:"全部文件",id:void 0}),v.value=e,(null==(l=r.value)?void 0:l.selected)||P()}))}function M(e={}){var l;null==(l=d.value)||l.open({title:"添加分类",width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:"分类名称",prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}],form:{...e},on:{submit(l,{done:a,close:t}){let i=null;i=e.id?s.space.type.update({...l,id:e.id}):s.space.type.add(l),i.then((()=>{D(),t()})).catch((e=>{n.error(e.message),a()}))}}})}function P(e){var l,a;e||(e=v.value[0]),e&&(t.refresh({page:1,classifyId:e.id}),null==(l=r.value)||l.select(e),null==(a=r.value)||a.setTitle(e.name))}return f((()=>{D()})),(a,t)=>{const i=y("el-button"),c=y("el-icon"),v=y("el-empty"),m=y("el-scrollbar"),f=y("cl-form");return g(),_(j,null,[h("div",W,[h("div",X,[Z,k(i,{type:"success",bg:"",size:"small",onClick:t[0]||(t[0]=e=>M())},{default:b((()=>[x("添加")])),_:1})]),h("div",H,[k(m,null,{default:b((()=>[h("ul",null,[(g(!0),_(j,null,w(F(z),((a,t)=>{var i,d;return g(),_("li",{key:t,class:S({"is-active":a.id==(null==(d=null==(i=F(r))?void 0:i.selected)?void 0:d.id)}),onClick:e=>P(a),onContextmenu:u((e=>function(e,{id:l,name:a}){if(!l)return!1;p.ContextMenu.open(e,{hover:{target:"item"},list:[{label:"刷新",callback(e){D(),e()}},{label:"编辑",callback(e){M({id:l,name:a}),e()}},{label:"删除",callback(e){o.confirm(`此操作将删除【${a}】下的文件, 是否继续?`,"提示",{type:"warning"}).then((()=>{s.space.type.delete({ids:[l]}).then((()=>{var e,a;n.success("删除成功"),l==(null==(a=null==(e=r.value)?void 0:e.selected)?void 0:a.id)&&P(),D()})).catch((e=>{n.error(e.message)}))})).catch((()=>null)),e()}}]})}(e,a)),["stop","prevent"])},[k(c,{class:"icon"},{default:b((()=>{var s,t;return[(null==(t=null==(s=F(r))?void 0:s.selected)?void 0:t.id)==a.id?(g(),C(F(e),{key:0})):(g(),C(F(l),{key:1}))]})),_:2},1024),h("span",null,q(a.name),1)],42,J)})),128)),0==F(z).length?(g(),C(v,{key:0,"image-size":80})):I("",!0)])])),_:1})])]),k(f,{ref_key:"Form",ref:d},null,512)],64)}}}),[["__scopeId","data-v-6b2853a3"]]),Q={class:"item-video"},Y=["src"],ee=v({name:"item-video"}),le=G(v({...ee,props:{data:Object,list:Array},setup(e,{expose:l}){const t=e,{space:i}=R(),n=E(),o=m((()=>t.data||{})),r=m((()=>void 0===o.value.progress||100===o.value.progress));function c(){var e;i.list.value.forEach((e=>{e.isPlay=o.value.id==e.id})),null==(e=n.value)||e.play()}function p(){var e;const l=i.list.value.find((e=>e.id==o.value.id));l&&(l.isPlay=!1),null==(e=n.value)||e.pause()}return D((()=>o.value.isPlay),(e=>{e?c():p()})),l({play:c,pause:p}),(e,l)=>{const t=y("el-icon");return g(),_("div",Q,[h("video",{ref_key:"Video",ref:n,src:F(o).url},null,8,Y),F(r)?(g(),_(j,{key:0},[F(o).isPlay?(g(),C(t,{key:0,class:"icon is-pause",onClick:u(p,["stop"])},{default:b((()=>[k(F(a))])),_:1},8,["onClick"])):(g(),C(t,{key:1,class:"icon is-play",onClick:u(c,["stop"])},{default:b((()=>[k(F(s))])),_:1},8,["onClick"]))],64)):I("",!0)])}}}),[["__scopeId","data-v-5c7586d0"]]),ae={class:"item-file__wrap"},se=["onContextmenu"],te={key:0,class:"item-file__error"},ie={class:"image-error"},ne={key:2,class:"item-file__name"},oe={class:"item-file__progress-bar"},re={class:"item-file__progress-value"},ce={key:2,class:"item-file__mask"},ue=v({name:"item-file"}),pe=G(v({...ue,props:{data:Object,list:Array},emits:["select","remove"],setup(e,{emit:l}){const a=e,{copy:s}=B(),{space:t}=R(),i=E(),o=m((()=>a.data||{})),c=m((()=>t.selection.value.findIndex((e=>e.id===o.value.id)))),d=m((()=>c.value>=0)),v=m((()=>o.value.preload||o.value.url)),f=m((()=>$(o.value.type||"")));function x(){l("select",o.value)}function w(e){p.ContextMenu.open(e,{hover:{target:"item-file__wrap"},list:[{label:"预览",callback(e){var l,s;"image"==o.value.type?null==(s=i.value)||s.open(o.value.url,null==(l=a.list)?void 0:l.filter((e=>"image"==e.type)).map((e=>e.url))):window.open(o.value.url),e()}},{label:"复制地址",callback(e){o.value.url&&(s(o.value.url),n.success("复制成功")),e()}},{label:d.value?"取消选中":"选中",callback(e){x(),e()}},{label:"删除",callback(e){l("remove",o.value),e()}}]})}return(l,a)=>{var s,t;const n=y("el-image"),p=y("el-progress");return g(),_(j,null,[h("div",ae,[h("div",{class:S(["item-file",[`is-${F(o).type}`]]),onClick:x,onContextmenu:u(w,["stop","prevent"])},[F(o).error?(g(),_("div",te,"上传失败："+q(F(o).error),1)):(g(),_(j,{key:1},["image"===F(o).type?(g(),C(n,{key:0,fit:"contain",src:F(v),lazy:""},{error:b((()=>[h("div",ie,[h("span",null,q(F(v)),1)])])),_:1},8,["src"])):"video"===F(o).type?(g(),C(le,{key:1,data:F(o),list:e.list},null,8,["data","list"])):(g(),_("span",ne,q(F(N)(F(v)))+"."+q(F(r)(F(v))),1)),h("span",{class:"item-file__type",style:A({backgroundColor:null==(s=F(f))?void 0:s.color})},q(null==(t=F(f))?void 0:t.label),5),F(o).progress>0&&F(o).progress<100?(g(),_(j,{key:3},[h("div",oe,[k(p,{percentage:F(o).progress,"show-text":!1},null,8,["percentage"])]),h("span",re,q(F(o).progress),1)],64)):I("",!0)],64)),F(d)?(g(),_("div",ce,[h("span",null,q(F(c)+1),1)])):I("",!0)],42,se)]),k(U,{ref_key:"Viewer",ref:i},null,512)],64)}}}),[["__scopeId","data-v-e2d978fb"]]),de={class:"cl-upload-panel__header"},ve={style:{margin:"0px 10px"}},me={"infinite-scroll-immediate":!1},fe={key:1,class:"empty"},ye=h("p",null,"将文件拖到此处，或点击按钮上传",-1),ge=v({name:"cl-upload-panel"}),_e=v({...ge,props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change"],setup(e,{expose:l,emit:a}){const s=e,{service:r,browser:u}=i(),{ViewGroup:p}=c(),d=E(),v=E(),m=E(!1),f=E([]),V=E([]),z=O({page:1,size:50,total:0});function q(){f.value=[]}function A(e){var l,a;r.space.info.add({classifyId:null==(a=null==(l=p.value)?void 0:l.selected)?void 0:a.id,...e}).then((l=>{e.id=l.id})).catch((e=>{n.error(e.message)}))}function G(e){V.value.unshift(e)}const N={page:1};async function U(e){var l;q(),Object.assign(N,{type:null==(l=s.accept)?void 0:l.split("/")[0],...z,...e}),1==N.page&&(m.value=!0),await r.space.info.page(N).then((e=>{Object.assign(z,e.pagination),1==N.page&&(V.value=[]),V.value.push(...e.list)})),m.value=!1}function $(e){const l=f.value.findIndex((l=>l.id===e.id));l>=0?f.value.splice(l,1):1==s.limit?f.value=[e]:f.value.length<s.limit&&f.value.push(e)}function B(e){const l=e?[e.id]:f.value.map((e=>e.id));o.confirm("此操作将删除文件, 是否继续?","提示",{type:"warning"}).then((()=>{n.success("删除成功"),l.forEach((e=>{[V.value,f.value].forEach((l=>{const a=l.findIndex((l=>l.id===e));l.splice(a,1)}))})),r.space.info.delete({ids:l}).catch((e=>{n.error(e.message)}))})).catch((()=>null))}function R(){V.value.length&&V.value.length<z.total&&U({page:z.page+1})}function W(e){e.preventDefault()}function X(e){e.preventDefault(),e.dataTransfer.files.forEach(((e,l)=>{setTimeout((()=>{d.value.upload(e)}),10*l)}))}return D(f,(e=>{a("selection-change",e)}),{deep:!0}),T("space",{selection:f,refresh:U,loading:m,list:V}),l({selection:f,open:open,close:close,clear:q,refresh:U}),(l,a)=>{const s=y("el-button"),i=y("cl-upload"),n=y("el-icon"),o=y("el-scrollbar"),r=y("cl-view-group"),c=M("infinite-scroll"),z=M("loading");return g(),_("div",{class:"cl-upload-panel",onDragover:W,onDrop:X},[k(r,{ref_key:"ViewGroup",ref:p,title:"全部文件"},{left:b((()=>[k(L)])),right:b((()=>[h("div",{class:"cl-upload-panel__right",ref_key:"Content",ref:v},[h("div",de,[k(s,{onClick:a[0]||(a[0]=e=>U({page:1}))},{default:b((()=>[x("刷新")])),_:1}),h("div",ve,[k(i,{ref_key:"Upload",ref:d,type:"file","show-file-list":!1,limit:e.limit,"limit-upload":!1,accept:e.accept,multiple:"",onSuccess:A,onUpload:G},{default:b((()=>[k(s,{type:"primary"},{default:b((()=>[x("点击上传")])),_:1})])),_:1},8,["limit","accept"])]),e.selectable?I("",!0):(g(),C(s,{key:0,type:"danger",disabled:0==f.value.length,onClick:a[1]||(a[1]=e=>B())},{default:b((()=>[x("删除选中文件")])),_:1},8,["disabled"]))]),P((g(),C(o,{class:"cl-upload-panel__file"},{default:b((()=>[P((g(),_("div",me,[V.value.length>0?(g(),_("div",{key:0,class:S(["list",{"is-mini":F(u).isMini}])},[(g(!0),_(j,null,w(V.value,(e=>(g(),_("div",{class:"item",key:e.preload||e.url},[k(pe,{data:e,list:V.value,onSelect:$,onRemove:B},null,8,["data","list"])])))),128))],2)):(g(),_("div",fe,[k(n,{class:"el-icon--upload"},{default:b((()=>[k(F(t))])),_:1}),ye]))])),[[c,R]])])),_:1})),[[z,m.value]])],512)])),_:1},512)],32)}}});export{_e as _};
